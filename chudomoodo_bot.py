import os, time, sqlite3, threading, random, re
from datetime import datetime, timedelta, date
from typing import List, Tuple, Optional
import requests

TOKEN = "8485558912:AAGMxJcqks9l7RoxK4U3NVcdtTnw6mdg1WQ"
API_URL = f"https://api.telegram.org/bot{TOKEN}"
DB_PATH = os.path.join(os.path.dirname(__file__), "joys.db")

POLL_TIMEOUT = 30
POLL_SLEEP = 1
USE_LANGTOOL = False
LANGTOOL_URL = "https://api.languagetool.org/v2/check"

# --- –ù–æ–≤—ã–π –º–æ—â–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –º–∞—Ç–∞ ---
BAD_WORD_PATTERNS = [
    r"–ø[i1!|]?[–∑3]–¥", r"–ø[i1!|]?[–∑3]–¥–µ—Ü", r"–ø[i1!|]?[–∑3]–¥–∞—Ç", r"–ø[i1!|]?[–∑3]–¥—é",
    r"[–µe—ë]–±", r"[–µe—ë]–±–∞–Ω", r"[–µe—ë]–±—É—á", r"[–µe—ë]–±–ª–∞–Ω",
    r"—Ö—É[–π–∏–∏–µ—é—è—É—ã0o]", r"—Öy[–π–∏–∏–µ—é—èo0]", r"—Ö\*–π",
    r"–æ—Ö—É[–µ—ë]–ª", r"–æ—Ö—É[–µ—ë]–Ω", r"–æ—Ö—Ä–µ–Ω",
    r"–±–ª[—èi1!|]–¥", r"–±–ª[—èi1!|]—Ç—å",
    r"–º–∞–Ω–¥–∞", r"–º–∞–Ω–¥–æ–≤", r"—Å—É—á–∫", r"—Å—É–∫–∞", r"—Å—É—á–∞—Ä",
    r"–≥–∞–Ω–¥", r"–≥–æ–Ω–¥–æ–Ω",
    r"–¥—Ä–æ—á", r"–∂–æ–ø", r"–∑–∞–ª—É–ø",
    r"–º—É–¥[–∞–æ]", r"–≥–æ–≤–Ω", r"–Ω–∞—Ö[—É—éi1!|o0]", r"–Ωa—Öy–π",
    r"fuck", r"f\*?ck", r"mf", r"motherf", r"shit", r"bitch",
    r"dick", r"cock", r"slut", r"whore",
]

def clean_profanity(text: str) -> str:
    cleaned = text
    for pattern in BAD_WORD_PATTERNS:
        cleaned = re.sub(pattern, lambda m: "*" * len(m.group()), cleaned, flags=re.IGNORECASE)
    return cleaned

# –≠–º–æ—Ü–∏–∏ –∏ —Å–ª–æ–≤–∞—Ä–∏ ‚Üì‚Üì‚Üì
GREETING_PATTERNS = ["–ø—Ä–∏–≤–µ—Ç","–ø—Ä–∏–≤–µ—Ç!","–ø—Ä–∏–≤–µ—Ç–∏–∫–∏","–ø—Ä–∏–≤–µ—Ç–∏–∫","–ø—Ä–∏–≤","—Ö–∞–π","—Ö–∞–π!","–∫—É","–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ","–¥–æ–±—Ä—ã–π –¥–µ–Ω—å","–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä","–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ"]
GREETING_RESPONSES = [
    "–ü—Ä–∏–≤–µ—Ç üôÇ –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ–≥–æ.",
    "–ü—Ä–∏–≤–µ—Ç. –î–∞–≤–∞–π –≤—Å–ø–æ–º–Ω–∏–º —á—Ç–æ –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Ä–∞–¥–æ–≤–∞–ª–æ —Ç–µ–±—è —Å–µ–≥–æ–¥–Ω—è.",
    "–ü—Ä–∏–≤–µ—Ç, —è –Ω–∞ —Å–≤—è–∑–∏. –ß—Ç–æ —Ö–æ—Ä–æ—à–µ–≥–æ –±—ã–ª–æ –≤ —ç—Ç–æ–º –¥–Ω–µ?",
    "–†–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å –∑–¥–µ—Å—å. –ß—Ç–æ —Å–µ–≥–æ–¥–Ω—è –¥–æ–±–∞–≤–∏–ª–æ —Ö–æ—Ç—å –∫–∞–ø–ª—é —Ç–µ–ø–ª–∞?",
    "–ü—Ä–∏–≤–µ—Ç. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –Ω–∞–ø–∏—à–∏ –æ–¥–Ω—É –º–∞–ª–µ–Ω—å–∫—É—é —Ä–∞–¥–æ—Å—Ç—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è.",
]

JOY_EMOJIS = ["‚ú®","üòä","üåà","üíõ","üåü"]
REMINDER_EMOJIS = ["‚ú®","üìå","üòä]()_
