
"""
chudomoodo_bot.py

Telegram-Ð±Ð¾Ñ‚ "Ð”Ð½ÐµÐ²Ð½Ð¸Ðº Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ñ… Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹".

Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:
- Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹-Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸;
- Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÑ‚ Ð¼Ð°Ñ‚ Ð¸ Ð½ÐµÑ†ÐµÐ½Ð·ÑƒÑ€Ð½ÑƒÑŽ Ð»ÐµÐºÑÐ¸ÐºÑƒ (Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ»Ð¾Ð²Ð°Ñ€ÑŒ ÐºÐ¾Ñ€Ð½ÐµÐ¹);
- (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾) Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ€Ñ„Ð¾Ð³Ñ€Ð°Ñ„Ð¸ÑŽ Ð¸ Ð¿ÑƒÐ½ÐºÑ‚ÑƒÐ°Ñ†Ð¸ÑŽ Ñ‡ÐµÑ€ÐµÐ· LanguageTool;
- ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ Ð² SQLite;
- Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð™ Ð Ð•Ð–Ð˜Ðœ:
    - Ð² 18:00 â€” Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ, ÐµÑÐ»Ð¸ Ð·Ð° Ð´ÐµÐ½ÑŒ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð½Ð¸ Ð¾Ð´Ð½Ð¾Ð¹ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸;
    - Ð² 21:00 â€” Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð·Ð° Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð´ÐµÐ½ÑŒ;
- Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ñ‚Ð¾ÑÐºÐ¸: Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸ Ð½Ð° Ð³Ñ€ÑƒÑÑ‚ÑŒ, ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ, Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ñƒ, Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹;
- ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹-Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ñ Ð¾Ð´Ð½Ð¸Ð¼ ÑÐ¼Ð¾Ð´Ð·Ð¸ Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ;
- Ð°Ñ‡Ð¸Ð²ÐºÐ¸ Ð·Ð° ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹ Ð¸ ÑÑ‚Ñ€Ð¸ÐºÐ¸ Ð¿Ð¾ Ð´Ð½ÑÐ¼ (Ð±ÐµÐ· ÑƒÐ¿Ð¾Ñ€Ð° Ð½Ð° Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð² Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÐ°Ñ…);
- ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ /stats;
- Ñ€Ð¸Ñ‚ÑƒÐ°Ð» Â«3 Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸Â» (Ð¼Ð¾Ð¶Ð½Ð¾ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°Ñ‚ÑŒ, ÑÐµÐ¹Ñ‡Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¼ÑÐ³ÐºÐ°Ñ);
- Ð¿Ð¸ÑÑŒÐ¼Ð¾ ÑÐµÐ±Ðµ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ Ð¿Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ /letter Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ /cancel;
- Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð°Ñ€Ð¸ Ð³Ñ€ÑƒÑÑ‚Ð¸, ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚Ð¸, Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸ Ð¸ Â«Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÂ»;
- Ð±Ð¾Ð»ÐµÐµ ÑˆÐ¸Ñ€Ð¾ÐºÐ¾Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ð¹ (Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€Ð½Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ñ‹, ÑÐ»ÐµÐ½Ð³);
- Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð´ÐµÐ½ÑŒ Ð½Ðµ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð¼Ð°Ñ‚, Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ Ð¸ Â«Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÂ»;
- Ð½Ð° Ð¾Ð´Ð½Ñƒ ÑÐ¼Ð¾Ñ†Ð¸ÑŽ â€” Ð¾Ð´Ð¸Ð½ Ð¾Ñ‚Ð²ÐµÑ‚ (Ð±ÐµÐ· Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹).
"""

import os
import time
import sqlite3
import threading
import random
import re
import json
from datetime import datetime, timedelta, date
from typing import List, Tuple, Optional, Dict

import requests

# --------------------------
# CONFIG
# --------------------------

TOKEN = os.getenv("TELEGRAM_TOKEN")
if not TOKEN:
    raise RuntimeError("ÐÐµ Ð·Ð°Ð´Ð°Ð½ TELEGRAM_TOKEN Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ.")

API_URL = f"https://api.telegram.org/bot{TOKEN}"
DB_PATH = os.path.join(os.path.dirname(__file__), "joys.db")

POLL_TIMEOUT = 30
POLL_SLEEP = 1

USE_LANGTOOL = False
LANGTOOL_URL = "https://api.languagetool.org/v2/check"

# --------------------------
# Ð¡Ð›ÐžÐ’ÐÐ Ð˜
# --------------------------
# Ð’Ð°Ð¶Ð½Ð¾: Ð½Ð¸Ð¶Ðµ Ð½Ðµ Â«Ñ€Ð¾Ð²Ð½Ð¾ 200/300 Ñ„Ñ€Ð°Ð·Â», Ð° Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ðµ ÑÐ¿Ð¸ÑÐºÐ¸ + ÐºÐ¾Ñ€Ð½Ð¸ ÑÐ»Ð¾Ð²,
# Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚ÑŒ Ð³Ð¾Ñ€Ð°Ð·Ð´Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð² Ð² Ð¶Ð¸Ð²Ð¾Ð¹ Ñ€ÐµÑ‡Ð¸.

# Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¼Ð°Ñ‚Ð¾Ð² Ð¸ "Ð¶Ñ‘ÑÑ‚ÐºÐ¾Ð¹" Ð»ÐµÐºÑÐ¸ÐºÐ¸.
BAD_WORDS = [
    # Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÐºÐ¾Ñ€Ð½Ð¸
    "Ñ…ÑƒÐ¹", "Ñ…ÑƒÐ¸", "Ñ…ÑƒÐµ", "Ñ…ÑƒÑ‘", "Ñ…ÑƒÑ", "Ñ…ÑƒÐµÐ¼", "Ñ…ÑƒÐ¹Ð½", "Ñ…ÑƒÐ¸Ñ‚", "Ñ…ÑƒÑÑ€",
    "Ñ…ÐµÑ€", "Ñ…Ñ€ÐµÐ½", "Ñ…Ñ€ÐµÐ½Ð°", "Ñ…Ñ€ÐµÐ½Ð¾Ð²", "Ñ…Ñ€ÐµÐ½Ð¾Ñ‚", "Ñ…Ñ€ÐµÐ½Ð¾Ñ‚ÐµÐ½ÑŒ",
    "Ð¿Ð¸Ð·Ð´", "Ð¿Ð¸Ð·Ð´Ð°", "Ð¿Ð¸Ð·Ð´ÐµÑ†", "Ð¿ÐµÐ·Ð´", "Ð¿Ð¸Ð´Ð¾Ñ€", "Ð¿Ð¸Ð´Ð°Ñ€", "Ð¿ÐµÐ´Ñ€Ð¸Ð»Ð°",
    "ÐµÐ±Ð°", "ÐµÐ±Ñƒ", "ÐµÐ±Ñ‘", "ÐµÐ±Ðµ", "ÐµÐ±Ð°Ð½", "Ñ‘Ð±Ð½", "ÐµÐ±Ð»Ð¾", "ÐµÐ±Ð°Ð»ÑŒÐ½", "Ð²Ñ‹ÐµÐ±",
    "ÐµÐ±Ð»Ð¸ÑÑŒ", "ÐµÐ±ÑƒÑ‡", "ÐµÐ±Ð°Ð½ÑƒÑ‚", "Ð´Ð¾ÐµÐ±", "Ð·Ð°ÐµÐ±", "Ð·Ð°Ñ‘Ð±", "Ð·Ð°Ð¸Ð¿Ð°Ð»", "Ð·Ð°Ð¸Ð¿Ð°Ð»Ð¸",
    "ÑÑƒÐºÐ°", "ÑÑƒÐºÐ¸", "ÑÑƒÑ‡Ðº", "ÑÑƒÑ‡Ð°Ñ€", "ÑÑƒÑ‡Ð¾Ð½Ð¾Ðº",
    "Ð±Ð»ÑÐ´", "Ð±Ð»Ñ", "Ð±Ð»ÑÑ‚", "Ð±Ð»ÑÑ…Ð°", "Ð±Ð»ÑÑ…Ð°-Ð¼ÑƒÑ…Ð°", "Ð±Ð»ÑÑ…Ð° Ð¼ÑƒÑ…Ð°",
    "Ð¼Ñ€Ð°Ð·ÑŒ", "Ñ‚Ð²Ð°Ñ€ÑŒ", "Ñ‚Ð²Ð°Ñ€Ð½", "ÑÐºÐ¾Ñ‚Ð¸Ð½Ð°", "ÑƒÐ±Ð»ÑŽÐ´", "ÑƒÐµÐ±Ðº", "ÑƒÑ‘Ð±Ðº",
    "Ð³Ð°Ð½Ð´Ð¾Ð½", "Ð¿Ñ€ÐµÐ·Ð¸Ðº", "ÐºÐ¾Ð½Ñ‡Ð°", "ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð½Ñ‹Ð¹", "ÐºÐ¾Ð½Ñ‡ÐµÐ½Ñ‹Ð¹",
    "Ñ…ÑƒÐ¹Ð½Ñ", "Ñ…ÑƒÑ‘Ð²", "Ñ…Ñ€ÐµÐ½Ð¾Ñ‚", "Ð³Ð¾Ð²Ð½Ð¾", "Ð³Ð¾Ð²Ð½", "Ð´ÐµÑ€ÑŒÐ¼", "ÑÑ€Ð°ÐºÐ°",
    "ÑÑƒÐºÐ°-Ð±Ð»ÑÑ‚ÑŒ", "ÑÑƒÐºÐ° Ð±Ð»ÑÑ‚ÑŒ",
    # Ð¾ÑÐºÐ¾Ñ€Ð±Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ
    "Ð´Ð¾Ð»Ð±Ð¾ÐµÐ±", "Ð´Ð¾Ð»Ð±Ð¾Ñ‘Ð±", "Ð´ÐµÐ±Ð¸Ð»", "Ð¸Ð´Ð¸Ð¾Ñ‚", "ÐºÑ€ÐµÑ‚Ð¸Ð½", "Ð¼ÑƒÐ´Ð°Ðº", "Ð¼ÑƒÐ´Ð¸Ð»Ð°",
    "Ñ‡Ð¼Ð¾", "Ñ‡Ð¼Ð¾ÑˆÐ½", "ÐºÐ¾Ð·Ð»Ð¸Ð½Ð°", "ÑƒÑ€Ð¾Ð´", "ÑƒÑ€Ð¾Ð´Ð¸Ð½",
    "ÑˆÐ»ÑŽÑ…", "Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ñ‚ÑƒÑ‚", "ÑˆÐ°Ð»Ð°Ð²", "Ñ‚Ñ€Ð°Ñ…Ð°", "Ñ‚Ñ€Ð°Ñ…Ð½Ñƒ",
    "ÑÑ€Ð°Ñ‚ÑŒ", "ÑÑ€Ð°Ð»", "Ð½Ð°ÑÑ€Ð°Ñ‚ÑŒ", "Ð½Ð°ÑÑ€Ð°Ð»",
    # Ð±Ð¾Ð»ÐµÐµ Ð·Ð°Ð²ÑƒÐ°Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ, Ð½Ð¾ Ð² Ñ‚Ð¾ÐºÑÐ¸Ñ‡Ð½Ð¾Ð¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ
    "Ð±ÐµÑÐ¸ÑˆÑŒ", "Ð¼Ð¾Ñ€Ð´Ð° ÐºÐ¸Ñ€Ð¿Ð¸Ñ‡Ð¾Ð¼", "Ð¸Ð´Ð¸ Ð² Ð¶Ð¾Ð¿Ñƒ", "Ð¿Ð¾ÑˆÐµÐ» Ð² Ð¶Ð¾Ð¿Ñƒ", "Ð¿Ð¾ÑˆÐ»Ð° Ð² Ð¶Ð¾Ð¿Ñƒ",
]

# Ð“Ñ€ÑƒÑÑ‚ÑŒ, Ñ‚Ð¾ÑÐºÐ°, Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ð°, Ð¾Ð´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾
SAD_PATTERNS = [
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ñ€Ð°Ð´ÑƒÐµÑ‚", "Ð½Ð¸Ñ‡Ñ‚Ð¾ Ð½Ðµ Ñ€Ð°Ð´ÑƒÐµÑ‚",
    "Ð²ÑÑ‘ Ð¿Ð»Ð¾Ñ…Ð¾", "Ð²ÑÐµ Ð¿Ð»Ð¾Ñ…Ð¾", "Ð²ÑÐµ ÑƒÐ¶Ð°ÑÐ½Ð¾", "Ð²ÑÑ‘ ÑƒÐ¶Ð°ÑÐ½Ð¾", "ÑÐ¾Ð²ÑÐµÐ¼ Ð¿Ð»Ð¾Ñ…Ð¾",
    "ÑƒÐ¶Ð°ÑÐ½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ", "Ð¾Ñ‚Ð²Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ", "Ð´ÐµÐ½ÑŒ Ð³Ð¾Ð²Ð½Ð¾", "Ð´ÐµÐ½ÑŒ Ð¾Ñ‚ÑÑ‚Ð¾Ð¹",
    "Ð´ÐµÐ½ÑŒ Ð±Ñ‹Ð» ÑƒÐ¶Ð°ÑÐ½Ñ‹Ð¹", "Ð´ÐµÐ½ÑŒ Ð½Ðµ Ð·Ð°Ð´Ð°Ð»ÑÑ", "Ð´ÐµÐ½ÑŒ ÐºÐ¾Ñ‚Ñƒ Ð¿Ð¾Ð´ Ñ…Ð²Ð¾ÑÑ‚",
    "Ð²ÑÑ‘ Ð±ÐµÑÐ¸Ñ‚", "Ð²ÑÐµ Ð±ÐµÑÐ¸Ñ‚", "Ð²ÑÐµ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶Ð°ÐµÑ‚", "Ð²ÑÑ‘ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶Ð°ÐµÑ‚",
    "Ð¿Ð»Ð¾Ñ…Ð¾", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ð»Ð¾Ñ…Ð¾", "ÐºÑ€Ð°Ð¹Ð½Ðµ Ð¿Ð»Ð¾Ñ…Ð¾",
    "Ñ‚ÑÐ¶ÐµÐ»Ð¾", "Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶ÐµÐ»Ð¾", "Ð´ÑƒÑˆÐ½Ð¾ Ð²Ð½ÑƒÑ‚Ñ€Ð¸",
    "Ð³Ñ€ÑƒÑÑ‚Ð½Ð¾", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð³Ñ€ÑƒÑÑ‚Ð½Ð¾", "Ð¼Ð½Ðµ Ð³Ñ€ÑƒÑÑ‚Ð½Ð¾", "Ð¼Ð½Ðµ Ð¾Ñ‡ÐµÐ½ÑŒ Ð³Ñ€ÑƒÑÑ‚Ð½Ð¾",
    "Ñ‚Ð¾ÑÐºÐ»Ð¸Ð²Ð¾", "Ð¼Ð½Ðµ Ñ‚Ð¾ÑÐºÐ»Ð¸Ð²Ð¾",
    "Ñ…Ñ€ÐµÐ½Ð¾Ð²Ð¾", "Ñ„Ð¸Ð³Ð¾Ð²Ð¾", "Ð¾Ñ‚ÑÑ‚Ð¾Ð¹Ð½Ð¾", "Ð¼ÐµÑ€Ð·ÐºÐ¾ Ð½Ð° Ð´ÑƒÑˆÐµ",
    "Ð´ÐµÐ¿Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾", "Ð´ÐµÐ¿Ñ€ÐµÑÑÐ¸Ñ Ð½Ð°ÐºÑ€Ñ‹Ð»Ð°", "Ð´ÐµÐ¿Ñ€ÐµÑÑÐ½ÑÐº", "Ð´ÑƒÑˆÐ° Ð½Ð¾ÐµÑ‚",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ", "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ", "Ð½ÐµÑ‚ Ð¶ÐµÐ»Ð°Ð½Ð¸Ñ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ",
    "Ð½ÐµÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ", "ÑƒÐ¶Ð°Ñ", "Ñ€Ð°Ð·Ð¾Ñ‡Ð°Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ", "ÑÐ¿Ð»Ð¾ÑˆÐ½Ð¾Ðµ Ñ€Ð°Ð·Ð¾Ñ‡Ð°Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ",
    "Ð¾Ð´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾", "Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ Ð¾Ð´Ð¸Ð½Ð¾ÐºÐ¾", "Ð¼Ð½Ðµ Ð¾Ð´Ð¸Ð½Ð¾ÐºÐ¾",
    "Ñ Ð¾Ð´Ð½Ð°", "Ñ Ð¾Ð´Ð¸Ð½", "Ð¾ÑÑ‚Ð°Ð»Ð°ÑÑŒ Ð¾Ð´Ð½Ð°", "Ð¾ÑÑ‚Ð°Ð»ÑÑ Ð¾Ð´Ð¸Ð½",
    "Ð½Ð¸ÐºÐ¾Ð¼Ñƒ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð°", "Ð½Ð¸ÐºÐ¾Ð¼Ñƒ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½",
    "Ð¼ÐµÐ½Ñ Ð½Ð¸ÐºÑ‚Ð¾ Ð½Ðµ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÐµÑ‚", "Ð½Ð¸ÐºÑ‚Ð¾ Ð½Ðµ Ð¿Ð¾Ð½Ð¸Ð¼Ð°ÐµÑ‚", "Ð¼ÐµÐ½Ñ Ð½Ðµ ÑÐ»Ñ‹ÑˆÐ°Ñ‚",
    "Ñ Ñ€ÐµÐ²Ñƒ", "Ñ Ð¿Ð»Ð°Ñ‡Ñƒ", "Ñ…Ð¾Ñ‡Ñƒ Ð¿Ð»Ð°ÐºÐ°Ñ‚ÑŒ", "Ð¿Ð»Ð°ÐºÐ°Ñ‚ÑŒ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ", "Ñ€Ñ‹Ð´Ð°ÑŽ",
    "Ð¾Ð¿ÑÑ‚ÑŒ ÑÐ¾Ñ€Ð²Ð°Ð»Ð°ÑÑŒ Ð² ÑÐ»ÐµÐ·Ñ‹", "Ð¾Ð¿ÑÑ‚ÑŒ Ð¿Ð»Ð°Ñ‡Ñƒ",
    "ÑÐµÑ€Ð´Ñ†Ðµ Ð±Ð¾Ð»Ð¸Ñ‚", "Ð½Ð° Ð´ÑƒÑˆÐµ Ñ‚ÑÐ¶ÐµÐ»Ð¾", "Ð½Ð° Ð´ÑƒÑˆÐµ Ð¿ÑƒÑÑ‚Ð¾", "Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¿ÑƒÑÑ‚Ð¾",
    "ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ð°", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿ÑƒÑÑ‚Ð¾ Ð²Ð½ÑƒÑ‚Ñ€Ð¸",
    "Ð½Ðµ Ð²Ð¸Ð¶Ñƒ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸", "Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ Ð½ÐµÑ‚", "Ð½ÐµÑ‚ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾",
    "Ð½Ðµ Ð·Ð° Ñ‡Ñ‚Ð¾ Ð·Ð°Ñ†ÐµÐ¿Ð¸Ñ‚ÑŒÑÑ", "Ð½Ðµ Ðº Ñ‡ÐµÐ¼Ñƒ Ð¿Ñ€Ð¸Ð¶Ð°Ñ‚ÑŒÑÑ Ð²Ð½ÑƒÑ‚Ñ€Ð¸",
    "Ð²ÑÐµ ÑÐµÑ€Ð¾Ðµ", "ÑÐ¿Ð»Ð¾ÑˆÐ½Ð°Ñ ÑÐµÑ€Ð°Ñ Ð¼Ð°ÑÑÐ°",
    "Ð¾Ñ‰ÑƒÑ‰ÐµÐ½Ð¸Ðµ Ð±ÐµÐ·Ñ‹ÑÑ…Ð¾Ð´Ð½Ð¾ÑÑ‚Ð¸", "Ð±ÐµÐ·Ñ‹ÑÑ…Ð¾Ð´Ð½Ð¾ÑÑ‚ÑŒ",
    "Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ Ñ€Ð°Ð·Ð±Ð¸Ñ‚Ð¾Ð¹", "Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ Ñ€Ð°Ð·Ð±Ð¸Ñ‚Ñ‹Ð¼",
    "Ñ€Ð°Ð·Ð±Ð¸Ñ‚Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ",
]

# Ð£ÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ, Ð²Ñ‹Ð³Ð¾Ñ€Ð°Ð½Ð¸Ðµ, Â«Ð½ÐµÑ‚ ÑÐ¸Ð»Â»
TIRED_PATTERNS = [
    "ÑƒÑÑ‚Ð°Ð»Ð°", "ÑƒÑÑ‚Ð°Ð»", "Ñ Ñ‚Ð°Ðº ÑƒÑÑ‚Ð°Ð»Ð°", "Ñ Ñ‚Ð°Ðº ÑƒÑÑ‚Ð°Ð»",
    "Ð¾Ñ‡ÐµÐ½ÑŒ ÑƒÑÑ‚Ð°Ð»Ð°", "Ð¾Ñ‡ÐµÐ½ÑŒ ÑƒÑÑ‚Ð°Ð»",
    "ÑÐ¸Ð»ÑŒÐ½Ð¾ ÑƒÑÑ‚Ð°Ð»Ð°", "ÑÐ¸Ð»ÑŒÐ½Ð¾ ÑƒÑÑ‚Ð°Ð»",
    "ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð±ÐµÐ· ÑÐ¸Ð»", "ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð½ÐµÑ‚ ÑÐ¸Ð»",
    "ÑÐ¸Ð» Ð½ÐµÑ‚", "Ð½ÐµÑ‚ ÑÐ¸Ð»", "Ð½Ð¸ Ð½Ð° Ñ‡Ñ‚Ð¾ Ð½ÐµÑ‚ ÑÐ¸Ð»",
    "ÑÐ¾Ð²ÑÐµÐ¼ Ð½ÐµÑ‚ ÑÐ¸Ð»", "Ð½Ð¸ ÐºÐ°Ð¿Ð»Ð¸ ÑÐ¸Ð»",
    "Ñ Ð²Ñ‹Ð¼Ð¾Ñ‚Ð°Ð»Ð°ÑÑŒ", "Ñ Ð²Ñ‹Ð¼Ð¾Ñ‚Ð°Ð»ÑÑ", "Ð²Ñ‹Ð¼Ð¾Ñ‚Ð°Ð»Ð°ÑÑŒ", "Ð²Ñ‹Ð¼Ð¾Ñ‚Ð°Ð»ÑÑ",
    "Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»Ð°", "Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»", "Ñ Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»Ð°", "Ñ Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»",
    "ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»Ð°", "ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð²Ñ‹Ð³Ð¾Ñ€ÐµÐ»",
    "Ð¼Ð¾Ñ€Ð°Ð»ÑŒÐ½Ð¾ ÑƒÑÑ‚Ð°Ð»Ð°", "Ð¼Ð¾Ñ€Ð°Ð»ÑŒÐ½Ð¾ ÑƒÑÑ‚Ð°Ð»",
    "Ñ Ð¾Ñ‡ÐµÐ½ÑŒ ÑƒÑÑ‚Ð°Ð»Ð° Ð¼Ð¾Ñ€Ð°Ð»ÑŒÐ½Ð¾", "Ñ Ð¾Ñ‡ÐµÐ½ÑŒ ÑƒÑÑ‚Ð°Ð» Ð¼Ð¾Ñ€Ð°Ð»ÑŒÐ½Ð¾",
    "Ð¾Ð±ÐµÑÑÐ¸Ð»ÐµÐ½Ð°", "Ð¾Ð±ÐµÑÑÐ¸Ð»ÐµÐ½", "Ð¾Ð±ÐµÑÑÐ¸Ð»ÐµÐ½Ð½Ñ‹Ð¹", "Ð¾Ð±ÐµÑÑÐ¸Ð»ÐµÐ½Ð½Ð°Ñ",
    "Ð¼Ð½Ðµ Ñ‚ÑÐ¶ÐµÐ»Ð¾", "Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶ÐµÐ»Ð¾", "Ð½ÐµÐ²Ñ‹Ð½Ð¾ÑÐ¸Ð¼Ð¾ Ñ‚ÑÐ¶ÐµÐ»Ð¾",
    "Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐ¸Ð»ÑŒÐ½ÑƒÑŽ ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ", "Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ",
    "Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… ÑÐ¸Ð»", "ÑÐ¸Ð» Ð±ÑƒÐºÐ²Ð°Ð»ÑŒÐ½Ð¾ Ð½Ð¾Ð»ÑŒ",
    "Ð¿ÑƒÑÑ‚Ð°Ñ ÐºÐ°Ðº Ð²Ñ‹Ð¶Ð°Ñ‚Ñ‹Ð¹ Ð»Ð¸Ð¼Ð¾Ð½", "ÐºÐ°Ðº Ð²Ñ‹Ð¶Ð°Ñ‚Ñ‹Ð¹ Ð»Ð¸Ð¼Ð¾Ð½",
    "Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½ÐµÑ‚ ÑÐ½ÐµÑ€Ð³Ð¸Ð¸", "ÑÐ½ÐµÑ€Ð³Ð¸Ñ Ð½Ð° Ð½ÑƒÐ»Ðµ",
    "Ð¸ÑÑ‚Ð¾Ñ‰ÐµÐ½Ð°", "Ð¸ÑÑ‚Ð¾Ñ‰ÐµÐ½", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð¸ÑÑ‚Ð¾Ñ‰ÐµÐ½Ð°", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð¸ÑÑ‚Ð¾Ñ‰ÐµÐ½",
    "Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð±Ð¾Ð»ÑŒÑˆÐµ", "Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ñ‚ÑÐ½ÑƒÑ‚ÑŒ", "Ð½Ðµ Ñ‚ÑÐ½Ñƒ",
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ", "Ð½ÐµÑ‚ Ñ€ÐµÑÑƒÑ€ÑÐ°", "Ð½ÐµÑ‚ Ñ€ÐµÑÑƒÑ€ÑÐ° Ð²Ð¾Ð¾Ð±Ñ‰Ðµ",
    "Ð½Ð°Ð´Ð¾ÐµÐ»Ð¾ Ð²ÑÐµ Ñ‚Ð°Ñ‰Ð¸Ñ‚ÑŒ", "ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸",
]

# Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°, ÑÑ‚Ñ€Ð°Ñ…, Ð¿Ð°Ð½Ð¸ÐºÐ°
ANXIETY_PATTERNS = [
    "Ð±Ð¾ÑŽÑÑŒ", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð±Ð¾ÑŽÑÑŒ", "Ð±ÐµÐ·ÑƒÐ¼Ð½Ð¾ Ð±Ð¾ÑŽÑÑŒ",
    "Ð¼Ð½Ðµ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾", "ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾", "Ð´Ð¸ÐºÐ¾ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾",
    "Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ", "ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ",
    "Ñ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ", "Ñ Ð¾Ð¿ÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ",
    "Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾", "Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾", "Ð´Ð¸ÐºÐ¾ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾",
    "Ð¼ÐµÐ½Ñ Ñ‚Ñ€ÑÑÐµÑ‚", "Ð¼ÐµÐ½Ñ Ñ‚Ñ€ÑÑÑ‘Ñ‚",
    "Ð¿Ð°Ð½Ð¸ÐºÐ°", "Ð¿Ð°Ð½Ð¸Ñ‡ÐµÑÐºÑƒÑŽ", "Ð¿Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ¸", "Ð¿Ð°Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°Ñ‚Ð°ÐºÐ°",
    "Ð¿Ð°Ð½Ð¸ÐºÑƒÑŽ", "Ð¾Ð¿ÑÑ‚ÑŒ Ð¿Ð°Ð½Ð¸ÐºÑƒÑŽ",
    "Ð²Ð´Ñ€ÑƒÐ³ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑÑ", "Ð²Ð´Ñ€ÑƒÐ³ Ð²ÑÑ‘ Ð¸ÑÐ¿Ð¾Ñ€Ñ‡Ñƒ", "Ð²Ð´Ñ€ÑƒÐ³ Ð²ÑÑ‘ Ð¿Ð¾Ð¹Ð´ÐµÑ‚ Ð½Ðµ Ñ‚Ð°Ðº",
    "Ð²Ð´Ñ€ÑƒÐ³ Ð²ÑÑ‘ Ð¿Ð¾Ð¹Ð´Ñ‘Ñ‚ Ð½Ðµ Ñ‚Ð°Ðº",
    "Ñ Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð°", "Ñ Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½", "Ñ Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð° Ð² ÑÐµÐ±Ðµ", "Ñ Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½ Ð² ÑÐµÐ±Ðµ",
    "Ñ ÑÐ¾Ð¼Ð½ÐµÐ²Ð°ÑŽÑÑŒ", "ÑÐ¾Ð¼Ð½ÐµÐ²Ð°ÑŽÑÑŒ Ð² ÑÐµÐ±Ðµ",
    "Ð²Ð¾Ð»Ð½ÑƒÑŽÑÑŒ", "Ñ Ð²Ð¾Ð»Ð½ÑƒÑŽÑÑŒ", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð²Ð¾Ð»Ð½ÑƒÑŽÑÑŒ",
    "Ñ Ð²ÑÐµ Ð¸ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð»Ð°", "Ñ Ð²ÑÐµ Ð¸ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð»",
    "Ñ Ð²ÑÑ‘ Ð¸ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð»Ð°", "Ñ Ð²ÑÑ‘ Ð¸ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð»",
    "Ð±Ð¾ÑŽÑÑŒ Ð¾ÑˆÐ¸Ð±Ð¸Ñ‚ÑŒÑÑ", "Ð±Ð¾ÑŽÑÑŒ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÑƒ",
    "ÑÑ‚Ñ€Ð°Ñ…, Ñ‡Ñ‚Ð¾ Ð½Ðµ ÑÐ¿Ñ€Ð°Ð²Ð»ÑŽÑÑŒ", "Ð±Ð¾ÑŽÑÑŒ, Ñ‡Ñ‚Ð¾ Ð½Ðµ ÑÐ¿Ñ€Ð°Ð²Ð»ÑŽÑÑŒ",
    "ÑÑ‚Ñ€Ð°Ñ… Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ³Ð¾", "ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾ Ð·Ð° Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ",
    "ÑÐµÑ€Ð´Ñ†Ðµ ÐºÐ¾Ð»Ð¾Ñ‚Ð¸Ñ‚ÑÑ", "ÑÐµÑ€Ð´Ñ†Ðµ ÑÑ‚ÑƒÑ‡Ð¸Ñ‚ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ ÑÐ¸Ð»ÑŒÐ½Ð¾",
    "Ñ€ÑƒÐºÐ¸ Ñ‚Ñ€ÑÑÑƒÑ‚ÑÑ", "Ð¼Ð½Ðµ Ñ‚ÑÐ¶ÐµÐ»Ð¾ Ð´Ñ‹ÑˆÐ°Ñ‚ÑŒ Ð¾Ñ‚ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸",
    "ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð²ÑÑ‘ Ð²Ð°Ð»Ð¸Ñ‚ÑÑ", "Ð¾Ñ‰ÑƒÑ‰ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾ Ð²ÑÑ‘ Ñ€ÑƒÑ…Ð½ÐµÑ‚",
    "Ð¼Ð½Ðµ Ð½Ðµ Ð¿Ð¾ ÑÐµÐ±Ðµ", "Ð¾Ñ‡ÐµÐ½ÑŒ Ð½Ðµ Ð¿Ð¾ ÑÐµÐ±Ðµ",
]

# ÐžÑ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹
SEVERE_SAD_PATTERNS = [
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð¶Ð¸Ñ‚ÑŒ", "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¶Ð¸Ñ‚ÑŒ",
    "Ð½ÐµÑ‚ ÑÐ¼Ñ‹ÑÐ»Ð° Ð¶Ð¸Ñ‚ÑŒ", "Ð½Ðµ Ð²Ð¸Ð¶Ñƒ ÑÐ¼Ñ‹ÑÐ»Ð° Ð¶Ð¸Ñ‚ÑŒ",
    "Ð½Ðµ Ð²Ð¸Ð¶Ñƒ ÑÐ¼Ñ‹ÑÐ»Ð°", "Ð½ÐµÑ‚ ÑÐ¼Ñ‹ÑÐ»Ð°",
    "Ð¶Ð¸Ð·Ð½ÑŒ Ð±ÐµÑÑÐ¼Ñ‹ÑÐ»ÐµÐ½Ð½Ð°", "Ð¶Ð¸Ð·Ð½ÑŒ Ð½Ðµ Ð¸Ð¼ÐµÐµÑ‚ ÑÐ¼Ñ‹ÑÐ»Ð°",
    "Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ ÑÐ²Ð¾ÑŽ Ð¶Ð¸Ð·Ð½ÑŒ", "Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ Ð¶Ð¸Ð·Ð½ÑŒ",
    "Ñ…Ð¾Ñ‡Ñƒ ÑƒÐ¼ÐµÑ€ÐµÑ‚ÑŒ", "Ñ…Ð¾Ñ‡Ñƒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¸ÑÑ‡ÐµÐ·Ð½ÑƒÑ‚ÑŒ",
    "Ð»ÑƒÑ‡ÑˆÐµ Ð±Ñ‹ Ð¼ÐµÐ½Ñ Ð½Ðµ Ð±Ñ‹Ð»Ð¾", "Ð»ÑƒÑ‡ÑˆÐµ Ð±Ñ‹ Ñ Ð½Ðµ Ñ€Ð¾Ð´Ð¸Ð»Ð°ÑÑŒ",
    "Ð»ÑƒÑ‡ÑˆÐµ Ð±Ñ‹ Ñ Ð½Ðµ Ñ€Ð¾Ð´Ð¸Ð»ÑÑ",
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ", "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ",
    "Ñ Ð½Ð¸Ñ‡Ñ‚Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾", "Ñ Ð½Ð¸ÐºÑ‡ÐµÐ¼Ð½Ð°Ñ", "Ñ Ð½Ð¸ÐºÑ‡ÐµÐ¼Ð½Ñ‹Ð¹",
    "Ñ Ð±ÐµÑÐ¿Ð¾Ð»ÐµÐ·Ð½Ð°Ñ", "Ñ Ð±ÐµÑÐ¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ð¹",
    "Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ ÑÐµÐ±Ñ", "ÑÐµÐ±Ñ Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ",
    "Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ Ð²ÑÑ‘", "Ð½ÐµÐ½Ð°Ð²Ð¸Ð¶Ñƒ Ð²ÑÐµÑ…",
    "Ð½Ð¸ÐºÐ¾Ð¼Ñƒ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð°", "Ð½Ð¸ÐºÐ¾Ð¼Ñƒ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½",
    "Ð½Ð¸ÐºÑ‚Ð¾ Ð¼ÐµÐ½Ñ Ð½Ðµ Ð»ÑŽÐ±Ð¸Ñ‚", "Ð¼ÐµÐ½Ñ Ð½Ð¸ÐºÑ‚Ð¾ Ð½Ðµ Ð»ÑŽÐ±Ð¸Ñ‚",
    "Ð½Ð¸ÐºÑ‚Ð¾ Ð¼ÐµÐ½Ñ Ð½Ðµ ÑÐ»Ñ‹ÑˆÐ¸Ñ‚ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ",
    "Ð¼Ð½Ðµ ÐºÐ°Ð¶ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµÐ¼ Ð±ÐµÐ· Ñ€Ð°Ð·Ð½Ð¸Ñ†Ñ‹", "Ð²ÑÐµÐ¼ Ð¿Ð»ÐµÐ²Ð°Ñ‚ÑŒ Ð½Ð° Ð¼ÐµÐ½Ñ",
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð¿Ñ€Ð¾ÑÑ‹Ð¿Ð°Ñ‚ÑŒÑÑ", "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð²ÑÑ‚Ð°Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÑƒÑ‚Ñ€Ð°Ð¼",
    "Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ð²Ð¸Ð¶Ñƒ Ð²Ñ‹Ñ…Ð¾Ð´Ð°",
]

# ÐÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ/Ð¿ÑƒÑÑ‚Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ Â«Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÂ» (ÐÐ• Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ð² Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸)
NO_JOY_PATTERNS = [
    # ÐÐµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ ÐµÑ‰Ðµ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ ÐµÑ‰Ñ‘ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ ÐµÑ‰Ðµ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ ÐµÑ‰Ñ‘ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ‡Ñ‚Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ ÐºÐ°Ðº Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ð¾ Ñ‡ÐµÐ¼ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",

    # ÐÐµÑ‡ÐµÐ³Ð¾ â€” Ð¿ÑƒÑÑ‚Ð¾
    "Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½ÐµÑ‡ÐµÐ³Ð¾ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ", "Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ",
    "ÑÐ¾Ð²ÑÐµÐ¼ Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½ÐµÑ‡ÐµÐ³Ð¾ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ", "Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ",

    # ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð·Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ð»Ð¾ÑÑŒ",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð½Ðµ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ð»Ð°", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð½Ðµ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ð»",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð½Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ ÑÐ²ÐµÑ‚Ð»Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",

    # ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð³Ð¾Ð»Ð¾Ð²Ñƒ
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð³Ð¾Ð»Ð¾Ð²Ñƒ",
    "Ð¼Ñ‹ÑÐ»Ð¸ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð½Ðµ Ð¸Ð´ÑƒÑ‚",
    "Ð¼Ð¾Ð·Ð³ Ð½Ðµ ÑÐ¾Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚",
    "Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… Ð¸Ð´ÐµÐ¹",
    "Ð¿ÑƒÑÑ‚Ð¾ Ð² Ð³Ð¾Ð»Ð¾Ð²Ðµ",
    "Ð³Ð¾Ð»Ð¾Ð²Ð° Ð¿ÑƒÑÑ‚Ð°Ñ",

    # ÐÐµÑ‚ ÑÐ¸Ð» Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ / Ð²ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ñ‚ÑŒ
    "Ð½ÐµÑ‚ ÑÐ¸Ð» Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½ÐµÑ‚ ÑÐ¸Ð» Ð²ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",

    # ÐÐµ Ð¼Ð¾Ð³Ñƒ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ
    "Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "ÑÐ»Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð½Ðµ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ñ‚ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ",

    # Ð‘Ñ‹Ð» Ð¿Ð»Ð¾Ñ…Ð¾Ð¹ Ð´ÐµÐ½ÑŒ â€” Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ
    "Ð´ÐµÐ½ÑŒ Ð±Ñ‹Ð» Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹",
    "Ð´ÐµÐ½ÑŒ Ð±Ñ‹Ð» ÑÐµÑ€Ñ‹Ð¹",
    "Ð´ÐµÐ½ÑŒ ÐºÐ°Ðº Ð´ÐµÐ½ÑŒ",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "ÐºÐ°Ð¶ÐµÑ‚ÑÑ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾",
    "Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð½Ð¾Ð³Ð¾",
    "Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð±ÐµÐ· Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹",
    "Ð¿ÑƒÑÑ‚Ð¾Ð¹ Ð´ÐµÐ½ÑŒ",
    "ÑÐµÑ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ",

    # Ð‘ÐµÐ·Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð¸Ðµ
    "Ð¼Ð½Ðµ Ð²ÑÐµ Ñ€Ð°Ð²Ð½Ð¾",
    "Ð½Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ Ð½Ð¸Ñ‡ÐµÐ³Ð¾",
    "Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… ÑÐ¼Ð¾Ñ†Ð¸Ð¹",
    "Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´ÐµÐ½ÑŒ Ð¸ Ð´ÐµÐ½ÑŒ",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ",
    "ÑÐ¼Ð¾Ñ†Ð¸Ð¹ Ð½ÐµÑ‚",

    # ÐŸÑ€Ð¾ÐºÑ€Ð°ÑÑ‚Ð¸Ð½Ð°Ñ†Ð¸Ñ/Ð¾Ñ‚ÐºÐ»Ð°Ð´Ñ‹Ð²Ð°Ð½Ð¸Ðµ
    "Ð½Ðµ ÑÐµÐ¹Ñ‡Ð°Ñ",
    "Ð¿Ð¾Ð·Ð¶Ðµ Ð½Ð°Ð¿Ð¸ÑˆÑƒ",
    "Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð½Ð°Ð¿Ð¸ÑˆÑƒ",
    "Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð·Ð¶Ðµ Ð²ÑÐ¿Ð¾Ð¼Ð½ÑŽ",
    "Ð½Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",

    # ÐÐµ Ð·Ð½Ð°ÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð»Ð¸ ÑÑ‚Ð¾
    "Ð½Ðµ Ð·Ð½Ð°ÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð»Ð¸ ÑÑ‚Ð¾",
    "Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð° Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ",
    "ÑÐ¾Ð¼Ð½ÐµÐ²Ð°ÑŽÑÑŒ Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ",
    "ÑÑ‚Ð¾ Ð²Ñ€Ð¾Ð´Ðµ Ð½Ðµ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ",
    "Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð° ÑÑ‚Ð¾Ð¸Ñ‚ Ð»Ð¸ ÑÑ‚Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",

    # Ð’ÑÑ‘ Ð¿Ð»Ð¾Ñ…Ð¾, Ð½Ð¾ Ð±ÐµÐ· ÑÐ²Ð½Ð¾Ð¹ Ð³Ñ€ÑƒÑÑ‚Ð¸ (Ð¿ÐµÑ€ÐµÑÐµÐºÐ°ÐµÑ‚ÑÑ Ñ SAD, Ð½Ð¾ Ð¼ÑÐ³Ñ‡Ðµ)
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ñ€Ð°Ð´ÑƒÐµÑ‚",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð½Ðµ Ð±Ñ‹Ð»Ð¾",
    "ÑÐ²Ð½Ð¾ Ð½ÐµÑ‡ÐµÐ¼Ñƒ Ñ€Ð°Ð´Ð¾Ð²Ð°Ñ‚ÑŒÑÑ",
    "Ð½Ðµ Ð·Ð° Ñ‡Ñ‚Ð¾ Ð·Ð°Ñ†ÐµÐ¿Ð¸Ñ‚ÑŒÑÑ",

    # ÐÐµ Ð´Ð¾ ÑÑ‚Ð¾Ð³Ð¾ / Ð½ÐµÑ‚ Ñ€ÐµÑÑƒÑ€ÑÐ°
    "Ð½ÐµÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½ÐµÑ‚ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ñ",
    "Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð´Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹",
    "Ð½Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹",
    "Ð½Ðµ Ð¼Ð¾Ð³Ñƒ ÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒÑÑ Ñ Ð¼Ñ‹ÑÐ»ÑÐ¼Ð¸",
    "Ñ‡ÐµÑÑ‚Ð½Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ñ Ð½ÐµÑ‡ÐµÐ³Ð¾",

    # Â«Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð±Ñ‹Ð»Ð¾, Ð½Ð¾â€¦Â»
    "Ð±Ñ‹Ð»Ð¾ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾, Ð½Ð¾ Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð°",
    "Ð²Ñ€Ð¾Ð´Ðµ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾",
    "ÐºÐ¾Ð³Ð´Ð°-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°ÑŽ",
    "Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð²ÑÐ¿Ð¾Ð¼Ð½ÑŽ",
    "Ñ€Ð°Ð½Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð¿Ð¾ÐºÐ°",

    # Ð›ÐµÐ½ÑŒ
    "Ð»ÐµÐ½ÑŒ Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ",
    "Ð»ÐµÐ½ÑŒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð¼Ð½Ðµ Ð»ÐµÐ½ÑŒ",
    "Ð¸Ð»Ð»ÑŽÐ·Ð¸Ñ Ñ‡Ñ‚Ð¾ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾, Ð½Ð¾ Ð»ÐµÐ½ÑŒ Ð²ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ñ‚ÑŒ",

    # Ð‘ÐµÐ· ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€Ð°ÑÐ°
    "Ð¾Ðº",
    "Ñ‚Ð°ÐºÐ¾Ðµ ÑÐµÐ±Ðµ",
    "Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾",
    "Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾, Ð½ÐµÑ‡ÐµÐ³Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ",
]


# Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð°/Ð¿Ð¸ÑÑŒÐ¼Ð°
CANCEL_PATTERNS = [
    "Ð¾Ñ‚Ð¼ÐµÐ½Ð°", "Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",
    "Ñ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°Ð»Ð°", "Ñ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°Ð»",
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð¿Ð¸ÑÑŒÐ¼Ð¾",
    "Ð½Ðµ Ñ…Ð¾Ñ‡Ñƒ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ÑŒ", "Ð½Ðµ Ð±ÑƒÐ´Ñƒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ",
    "/cancel",
]

# ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ â€” ÑÐ¸Ð»ÑŒÐ½Ð¾ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ (ÐºÐ¾Ñ€Ð½Ð¸ Ð¸ Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€Ð½Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ñ‹)
GREETING_PATTERNS = [
    "Ð¿Ñ€Ð¸Ð²ÐµÑ‚", "Ð¿Ñ€Ð¸Ð²ÐµÑ‚!", "Ð¿Ñ€Ð¸Ð²ÐµÑ‚Ð¸Ðº", "Ð¿Ñ€Ð¸Ð²ÐµÑ‚Ð¸ÐºÐ¸",
    "Ð¿Ñ€Ð¸Ð²ÐµÑ‚)", "Ð¿Ñ€Ð¸Ð²ÐµÑ‚))", "Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽ",
    "Ð·Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹", "Ð·Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ", "Ð·Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ)",
    "Ð´Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ", "Ð´Ð¾Ð±Ñ€Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€", "Ð´Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾", "Ð´Ð¾Ð±Ñ€Ð¾Ð¹ Ð½Ð¾Ñ‡Ð¸",
    "Ñ…Ð°Ð¹", "Ñ…Ð°Ð¹!", "Ñ…Ð°Ð¹)", "Ñ…ÑÐ¹", "Ñ…ÐµÐ¹", "Ñ…ÐµÐ»Ð»Ð¾", "Ñ…ÐµÐ»Ð»Ð¾Ñƒ",
    "hello", "hi", "hey",
    "Ð¹Ð¾Ñƒ", "Ð¹Ð¾", "Ð¹Ð¾Ñƒ)", "Ð¹Ð¾Ñƒ!",
    "ÐºÑƒ", "ÐºÑƒ!", "ÐºÑƒ)",
    "Ð·Ð´Ð¾Ñ€Ð¾Ð²Ð¾", "Ð·Ð´Ð¾Ñ€Ð¾Ð²", "Ð·Ð´Ð°Ñ€Ð¾Ð²Ð°", "Ð·Ð´Ð°Ñ€Ð¾Ð²", "Ð·Ð´Ð¾Ñ€Ð¾Ð²Ð°",
    "ÑÐ°Ð»ÑŽÑ‚", "ÑˆÐ°Ð»Ð¾Ð¼", "Ð±Ð¾Ð½Ð¶ÑƒÑ€", "Ñ…Ð¾Ð»Ð°",
    "Ð´Ð¾Ð±Ñ€Ð¾Ð³Ð¾ Ð´Ð½Ñ", "Ð´Ð¾Ð±Ñ€Ð¾Ð³Ð¾ Ð²ÐµÑ‡ÐµÑ€Ð°",
    "Ñ€Ð°Ð´ Ñ‚ÐµÐ±Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ", "Ñ€Ð°Ð´Ð° Ñ‚ÐµÐ±Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ",
    "ÑÐ½Ð¾Ð²Ð° Ñ", "ÑÑ‚Ð¾ Ñ ÑÐ½Ð¾Ð²Ð°",
]

GREETING_RESPONSES = [
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. ÐšÐ°Ðº Ñ‚Ð²Ð¾Ð¹ Ð´ÐµÐ½ÑŒ? Ð Ð°ÑÑÐºÐ°Ð¶ÐµÑˆÑŒ Ñ‡Ñ‚Ð¾-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¾Ð½Ð¾ ÑÐ¾Ð²ÑÐµÐ¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ?",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ñ Ñ‚ÑƒÑ‚. ÐœÐ¾Ð¶ÐµÑˆÑŒ ÑÐºÐ¸Ð½ÑƒÑ‚ÑŒ Ð¾Ð´Ð½Ñƒ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ â€” Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÑÑ‚Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²ÐºÑƒÑÐ½Ñ‹Ð¹ Ñ‡Ð°Ð¹.",
    "Ð Ð°Ð´Ð° Ñ‚ÐµÐ±Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð·Ð´ÐµÑÑŒ. Ð”Ð°Ð²Ð°Ð¹ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð¼ Ñ‡Ñ‚Ð¾-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ðµ Ð¸Ð· ÑÑ‚Ð¾Ð³Ð¾ Ð´Ð½Ñ?",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¼Ð¾Ð¶ÐµÐ¼ Ð²Ð¼ÐµÑÑ‚Ðµ Ð¿Ð¾Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ ÑÐ²ÐµÑ‚Ð»Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð² Ñ‚Ð²Ð¾Ñ‘Ð¼ Ð´Ð½Ðµ.",
    "Ð¥ÐµÐ¹. Ð—Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ñ‹Ð´Ð¾Ñ…Ð½ÑƒÑ‚ÑŒ Ð¸ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ Ñ…Ð¾Ñ‚ÑŒ Ð¾Ð´Ð½Ñƒ ÑˆÑ‚ÑƒÐºÑƒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ ÑÐ´ÐµÐ»Ð°Ð»Ð° Ð´ÐµÐ½ÑŒ Ñ‡ÑƒÑ‚ÑŒ Ð¼ÑÐ³Ñ‡Ðµ.",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ ÑÐ°Ð¼Ð¾Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ â€” Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ‚Ñ‹ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð´Ð¾Ð±Ñ€Ð°Ð»Ð°ÑÑŒ Ð´Ð¾ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚Ð°.",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ñ Ð½Ð° ÑÐ²ÑÐ·Ð¸. Ð•ÑÐ»Ð¸ Ð´ÐµÐ½ÑŒ Ð±Ñ‹Ð» Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ð¹, Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑˆÑ‚ÑƒÐºÑƒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ ÐµÐ³Ð¾ Ñ…Ð¾Ñ‚ÑŒ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ ÑÐ³Ð»Ð°Ð´Ð¸Ð»Ð°.",
    "Ð Ð°Ð´Ð°, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð·Ð°Ð³Ð»ÑÐ½ÑƒÐ»Ð°. Ð”Ð°Ð²Ð°Ð¹ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð¼ ÑÑŽÐ´Ð° Ð¾Ð´Ð½Ñƒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´ÐµÐ½ÑŒ Ð½Ðµ Ð·Ð°Ñ‚ÐµÑ€ÑÐ»ÑÑ.",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ: Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð»Ð¾ Ð½Ðµ ÑÐ¾Ð²ÑÐµÐ¼ ÑƒÐ¶Ð°ÑÐ½Ñ‹Ð¼ â€” Ð¸ ÑÑ‚Ð¾ ÑƒÐ¶Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¾.",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð´Ñ€ÑƒÐ¶Ð¸Ñ‰Ðµ. Ð”Ð°Ð²Ð°Ð¹ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð½Ð°Ð¹Ñ‚Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾, Ð·Ð° Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¼Ð¾Ð¶Ð½Ð¾ Ñ‚Ð¸Ñ…Ð¾ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐµÐ±Ðµ Â«ÑÐ¿Ð°ÑÐ¸Ð±Ð¾Â».",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. Ð¯ Ñ‚ÑƒÑ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾ ÑÐ»Ð¾Ð¶Ð¸Ñ‚ÑŒ Ñ‚Ð²Ð¾Ð¸ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ Ð² Ð¾Ð´Ð½Ð¾ Ð¼ÐµÑÑ‚Ð¾.",
    "Ð Ð°Ð´Ð° Ñ‚Ð²Ð¾ÐµÐ¼Ñƒ Â«Ð¿Ñ€Ð¸Ð²ÐµÑ‚Â». Ð§Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ ÑÐ¾Ð³Ñ€ÐµÐ»Ð¾ â€” Ð¿ÑƒÑÑ‚ÑŒ Ð´Ð°Ð¶Ðµ Ð½Ð° Ð¿Ð°Ñ€Ñƒ ÑÐµÐºÑƒÐ½Ð´?",
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚. ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ Ñ‡ÐµÐ³Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð³Ð¾: Ð²ÐºÑƒÑÐ½Ð°Ñ ÐµÐ´Ð°, Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ°, Ð¼ÑƒÐ·Ñ‹ÐºÐ°, Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð¿Ð»ÐµÐ´.",
    "ÐÑƒ Ð¿Ñ€Ð¸Ð²ÐµÑ‚. Ð Ð°ÑÑÐºÐ°Ð¶ÐµÑˆÑŒ, Ð·Ð° Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ð¹ Ð´ÐµÐ½ÑŒ Ð²ÑÑ‘-Ñ‚Ð°ÐºÐ¸ ÑÑ‚Ð¾Ð¸Ñ‚ Ð·Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ?",
    "ÐžÑ‡ÐµÐ½ÑŒ Ñ€Ð°Ð´Ð° Ñ‚ÐµÐ±Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð·Ð´ÐµÑÑŒ. Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ â€” Ð¿Ð¸ÑˆÐ¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð² ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾Ð¹ Ñ„Ð¾Ñ€Ð¼Ðµ, Ñ‡Ñ‚Ð¾ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»Ð¾.",
]

JOY_EMOJIS = ["âœ¨", "ðŸ˜Š", "ðŸŒˆ", "ðŸ’›", "ðŸŒŸ"]
REMINDER_EMOJIS = ["âœ¨", "ðŸ“Œ", "ðŸ˜Š"]
STATS_EMOJIS = ["ðŸ“Š", "ðŸ“ˆ", "â­"]
CALM_EMOJIS = ["ðŸ™‚", "ðŸŒ¿", "âœ¨", "â˜•", "ðŸ•Š", "ðŸƒ"]

# ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ð³Ñ€ÑƒÑÑ‚ÑŒ
SAD_RESPONSES = [
    "Ð—Ð²ÑƒÑ‡Ð¸Ñ‚ ÐºÐ°Ðº Ð¾Ñ‡ÐµÐ½ÑŒ Ð½ÐµÐ¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð´ÐµÐ½ÑŒ. ÐÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð² Ð½Ñ‘Ð¼ Ð¿Ð»ÑŽÑÑ‹.\n\n"
    "Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¶Ðµ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸ÑˆÑŒ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, Ð³Ð´Ðµ ÑÑ‚Ð°Ð»Ð¾ Ñ…Ð¾Ñ‚ÑŒ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð»ÐµÐ³Ñ‡Ðµ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸, Ñ Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾ ÐµÐ³Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ.",

    "ÐŸÐ¾Ð½Ð¸Ð¼Ð°ÑŽ, Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¼Ð¾Ð³Ð»Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ñ‚ÑÐ¶ÐºÐ¾.\n\n"
    "Ð˜Ð½Ð¾Ð³Ð´Ð° ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ â€” ÑÑ‚Ð¾ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ½ÑŒ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»ÑÑ. Ð ÐµÑÐ»Ð¸ Ð²Ð´Ñ€ÑƒÐ³ Ð²ÑÐ¿Ð»Ñ‹Ð²Ñ‘Ñ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ‡ÑƒÑ‚ÑŒ Ð¼ÑÐ³Ñ‡Ðµ â€” Ñ Ð·Ð´ÐµÑÑŒ.",

    "Ð‘Ñ‹Ð²Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ½ÑŒ ÑÐ¾Ð²ÑÐµÐ¼ Ð½Ðµ Ñ€Ð°Ð´ÑƒÐµÑ‚. Ð¢Ð°Ðº Ñ‚Ð¾Ð¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¶Ð¸Ñ‚ÑŒ ÐºÐ°ÐºÐ¾Ðµ-Ñ‚Ð¾ Ð²Ñ€ÐµÐ¼Ñ.\n\n"
    "Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð½Ð°Ð¹Ñ‚Ð¸ Ð¾Ð´Ð½Ñƒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ð¾Ð¿Ð¾Ñ€Ñƒ: Ð²Ð·Ð³Ð»ÑÐ´, ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ð¿Ð°ÑƒÐ·Ñƒ, Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð½Ð°Ð¿Ð¸Ñ‚Ð¾Ðº.",

    "Ð¡Ð»Ñ‹ÑˆÑƒ, Ñ‡Ñ‚Ð¾ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¼Ð½Ð¾Ð³Ð¾ Ñ‚ÑÐ¶ÐµÑÑ‚Ð¸.\n\n"
    "ÐÐµ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¸Ñ‚Ð²Ð¾Ñ€ÑÑ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ð²ÑÑ‘ Ð¾Ðº. Ð•ÑÐ»Ð¸ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ñ…Ð¾Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð½Ðµ Ð¿Ñ€Ð¾ Â«ÑƒÐ¶Ð°ÑÂ», Ð° Ð¿Ñ€Ð¾ Â«Ñ‡ÑƒÑ‚ÑŒ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½ÐµÐµÂ» â€” Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¼Ð½Ðµ Ð¾ Ð½Ñ‘Ð¼.",

    "Ð­Ñ‚Ð¾Ñ‚ Ð´ÐµÐ½ÑŒ ÑÐ²Ð½Ð¾ Ð½Ðµ Ð¸Ð· Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ….\n\n"
    "ÐœÐ¾Ð¶ÐµÐ¼ Ð¿Ð¾ÐºÐ° Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐµÐ³Ð¾ Ð¿Ñ€Ð¾ÑˆÐ»Ð°. Ð Ðº Ñ€Ð°Ð´Ð¾ÑÑ‚ÑÐ¼ Ð²ÐµÑ€Ð½Ñ‘Ð¼ÑÑ, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ñ…Ð¾Ñ‚ÑŒ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ñ€ÐµÑÑƒÑ€ÑÐ°.",

    "ÐšÐ¾Ð³Ð´Ð° Ð²ÑÑ‘ ÐºÐ°Ð¶ÐµÑ‚ÑÑ ÑÐµÑ€Ñ‹Ð¼, Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ Ð²Ñ‹Ñ‚Ð°Ñ‰Ð¸Ñ‚ÑŒ Ð¸Ð· Ð´Ð½Ñ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ.\n\n"
    "Ð•ÑÐ»Ð¸ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð³Ð´Ð°-Ð½Ð¸Ð±ÑƒÐ´ÑŒ ÑÑ‚Ð°Ð½ÐµÑ‚ Ð½Ð° Ð¿Ð°Ñ€Ñƒ Ð³Ñ€Ð°Ð´ÑƒÑÐ¾Ð² Ñ‚ÐµÐ¿Ð»ÐµÐµ â€” Ñ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒÑŽ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ.",

    "Ð—Ð²ÑƒÑ‡Ð¸Ñ‚, ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð´ÐµÐ½ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð·Ð°Ð±Ñ€Ð°Ð», Ñ‡ÐµÐ¼ Ð´Ð°Ð».\n\n"
    "Ð¢Ñ‹ Ð¸Ð¼ÐµÐµÑˆÑŒ Ð¿Ñ€Ð°Ð²Ð¾ Ð½Ð° ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ Ð¸ Ñ€Ð°Ð·Ð¾Ñ‡Ð°Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ. ÐŸÐ¾Ñ‚Ð¾Ð¼, ÐºÐ¾Ð³Ð´Ð° Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¼Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÐ¼ Ð¿Ð¾Ð¸ÑÐºÐ°Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‰ÐµÐµ.",
]

# ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ
TIRED_RESPONSES = [
    "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ð´ÐµÐ½ÑŒ Ñ‚ÐµÐ±Ñ Ð¾ÑÐ½Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð²Ñ‹Ð¶Ð°Ð».\n\n"
    "Ð­Ñ‚Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾ ÑÐ»Ð°Ð±Ð¾ÑÑ‚ÑŒ, Ð° Ð¿Ñ€Ð¾ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ñ‚Ð°Ñ‰Ð¸ÑˆÑŒ. Ð•ÑÐ»Ð¸ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸ÑˆÑŒ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, Ð³Ð´Ðµ ÑÑ‚Ð°Ð»Ð¾ Ñ…Ð¾Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾Ð»Ñ‚Ð¾Ð½Ð° Ð»ÐµÐ³Ñ‡Ðµ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸.",

    "Ð¡Ð»Ñ‹ÑˆÑƒ ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ Ð´Ð¾ ÐºÐ¾ÑÑ‚ÐµÐ¹.\n\n"
    "ÐÐµ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð¾Ð±ÑÐ·Ð°Ð½ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¼. Ð˜Ð½Ð¾Ð³Ð´Ð° Ð»ÑƒÑ‡ÑˆÐ°Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ â€” ÑÑ‚Ð¾ Ð²Ð¾Ð²Ñ€ÐµÐ¼Ñ Ð»ÐµÑ‡ÑŒ, Ð¿Ð¾ÐµÑÑ‚ÑŒ Ð¸ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐµÐ±Ñ Ð² Ð¿Ð¾ÐºÐ¾Ðµ.",

    "ÐžÑ‡ÐµÐ½ÑŒ Ð¿Ð¾Ñ…Ð¾Ð¶Ðµ Ð½Ð° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Â«Ð±Ð°Ñ‚Ð°Ñ€ÐµÐ¹ÐºÐ° Ð½Ð° Ð½ÑƒÐ»ÐµÂ».\n\n"
    "Ð•ÑÐ»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð» Ñ…Ð¾Ñ‚ÑŒ Ð¼Ð¸Ð½ÑƒÑ‚Ð½Ñ‹Ð¹ Ð²Ñ‹Ð´Ð¾Ñ… â€” Ð³Ð¾Ñ€ÑÑ‡Ð¸Ð¹ Ð´ÑƒÑˆ, Ñ‡Ð°Ð¹, Ñ‚Ð¸ÑˆÐ¸Ð½Ð° â€” Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ, Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ ÑÑ‚Ð¾ ÐºÐ°Ðº Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ð¾Ð¿Ð¾Ñ€Ñƒ.",

    "Ð”ÐµÐ½ÑŒ Ð·Ð°Ð±Ñ€Ð°Ð» Ð¼Ð½Ð¾Ð³Ð¾ ÑÐ¸Ð».\n\n"
    "Ð¢Ñ‹ Ð²ÑÑ‘ Ñ€Ð°Ð²Ð½Ð¾ Ð´Ð¾ÑˆÐ»Ð° Ð´Ð¾ ÑÑ‚Ð¾Ð³Ð¾ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° â€” ÑƒÐ¶Ðµ Ð½ÐµÐ¼Ð°Ð»Ð¾. Ð•ÑÐ»Ð¸ Ð²ÑÐ¿Ð»Ñ‹Ð²Ñ‘Ñ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð¼Ð¾Ð³Ð»Ð¾ Ð½Ðµ Ñ€Ð°Ð·Ð²Ð°Ð»Ð¸Ñ‚ÑŒÑÑ, Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¼Ð½Ðµ Ð¾Ð± ÑÑ‚Ð¾Ð¼.",

    "ÐŸÐ¾Ð½Ð¸Ð¼Ð°ÑŽ, ÐºÐ°Ðº ÑÑ‚Ð¾ â€” ÐºÐ¾Ð³Ð´Ð° Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ.\n\n"
    "Ð•ÑÐ»Ð¸ Ð±ÑƒÐ´ÐµÑ‚ Ð¶ÐµÐ»Ð°Ð½Ð¸Ðµ, Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð¼ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð±Ñ‹Ð» Ð½Ðµ Ñ‚Ð°ÐºÐ¸Ð¼ Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ð¼, ÐºÐ°Ðº Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ.",
]

# ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ñƒ
ANXIETY_RESPONSES = [
    "Ð§ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑ‚ÑÑ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð°. ÐžÐ±Ñ‹Ñ‡Ð½Ð¾ Ð¾Ð½Ð° Ð¿Ñ€Ð¾ Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ Ð²Ð°Ð¶Ð½Ð¾, Ð° Ð½Ðµ Ð¿Ñ€Ð¾ ÑÐ»Ð°Ð±Ð¾ÑÑ‚ÑŒ.\n\n"
    "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, ÐºÐ¾Ð³Ð´Ð° Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ‚Ð°Ð»Ð¾ Ñ…Ð¾Ñ‚ÑŒ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ñ‚Ð¸ÑˆÐµ â€” Ñ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒÑŽ ÐµÐ³Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ.",

    "Ð’Ð¸Ð¶Ñƒ, ÐºÐ°Ðº ÑÐ¸Ð»ÑŒÐ½Ð¾ Ñ‚Ñ‹ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÐµÑˆÑŒ.\n\n"
    "Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð¾Ð¿ÐµÑ€ÐµÑ‚ÑŒÑÑ Ð½Ð° Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ðµ: Ñ‡Ð°Ð¹, Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ°, ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ ÑÐ²Ð¾ÐµÐ³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°. Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¾Ð± ÑÑ‚Ð¾Ð¼ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ðµ.",

    "Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð° ÑƒÐ¼ÐµÐµÑ‚ Ð½Ð°ÐºÑ€ÑƒÑ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ð¼Ñ‹ÑÐ»Ð¸ Ð´Ð¾ Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°.\n\n"
    "ÐÐ¾ Ð²ÑÑ‘ Ð¶Ðµ Ð² Ð´Ð½Ðµ Ð¼Ð¾Ð³Ð»Ð¸ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ðµ ÑÐ¿Ð¸Ð·Ð¾Ð´Ñ‹, Ð³Ð´Ðµ Ñ‚Ñ‹ Ð²Ñ‹Ð´ÐµÑ€Ð¶Ð°Ð»Ð° ÑÑ‚Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ. ÐœÐ¾Ð¶ÐµÐ¼ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ð¸Ð· Ð½Ð¸Ñ….",

    "Ð’Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ â€” Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ñ, ÐºÐ¾Ð³Ð´Ð° Ð¼Ð½Ð¾Ð³Ð¾ Ð½ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾ÑÑ‚Ð¸.\n\n"
    "Ð•ÑÐ»Ð¸ Ñ‚Ñ‹ Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸ÑˆÑŒ, Ð³Ð´Ðµ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ñ‚ÐµÐ±Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ñ…Ð¾Ñ‚ÑŒ Ð½Ð° ÑÐµÐºÑƒÐ½Ð´Ñƒ Ð²Ñ‹Ð´Ð¾Ñ…Ð½ÑƒÑ‚ÑŒ â€” Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¼Ð½Ðµ, Ñ ÑÑ‚Ð¾ Ð·Ð°Ð¿Ð¾Ð¼Ð½ÑŽ.",

    "Ð—Ð²ÑƒÑ‡Ð¸Ñ‚ Ñ‚Ð°Ðº, Ð±ÑƒÐ´Ñ‚Ð¾ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð³Ñ€Ð¾Ð¼ÐºÐ¾.\n\n"
    "Ð”Ð°Ð²Ð°Ð¹ Ð½Ðµ Ð±ÑƒÐ´ÐµÐ¼ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚ ÑÐµÐ±Ñ ÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ñ, Ð½Ð¾ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð½Ð°Ð¹Ñ‚Ð¸ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Â«Ñ ÑÐ¿Ñ€Ð°Ð²Ð¸Ð»Ð°ÑÑŒ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð·Ð´ÐµÑÑŒÂ».",
]

# ÐžÑ‚Ð²ÐµÑ‚Ñ‹, ÐºÐ¾Ð³Ð´Ð° Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð¿Ð¸ÑˆÐµÑ‚ Â«Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÂ»
NO_JOY_RESPONSES = [
    "Ð‘Ñ‹Ð²Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ½ÑŒ Ð±ÑƒÐ´Ñ‚Ð¾ Ð¿ÑƒÑÑ‚Ð¾Ð¹. ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð²Ñ‹Ð¶Ð¸Ð¼Ð°Ñ‚ÑŒ Ð¸Ð· ÑÐµÐ±Ñ. Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¶Ðµ Ð²ÑÐ¿Ð»Ñ‹Ð²Ñ‘Ñ‚ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ‚Ñ‘Ð¿Ð»Ð¾Ðµ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸.",
    "ÐÐ¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð½Ðµ Ð·Ð½Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ. Ð˜Ð½Ð¾Ð³Ð´Ð° Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð²ÑÐ¿Ð»Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¶Ðµ â€” Ð¿Ð¾ Ð´Ð¾Ñ€Ð¾Ð³Ðµ Ð´Ð¾Ð¼Ð¾Ð¹, Ð·Ð° Ñ‡Ð°ÐµÐ¼ Ð¸Ð»Ð¸ Ð¿ÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼.",
    "ÐžÐºÐµÐ¹, Ð¾ÑÑ‚Ð°Ð²Ð¸Ð¼ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ñ‚Ð°ÐºÐ¸Ð¼, ÐºÐ°Ðº ÐµÑÑ‚ÑŒ. Ð•ÑÐ»Ð¸ Ð·Ð° Ð´ÐµÐ½ÑŒ Ð¼ÐµÐ»ÑŒÐºÐ½Ñ‘Ñ‚ Ñ…Ð¾Ñ‚ÑŒ Ð¼Ð°Ð»ÑŽÑÐµÐ½ÑŒÐºÐ¸Ð¹ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ñ‹Ð¹ ÑÐ¿Ð¸Ð·Ð¾Ð´ â€” Ñ Ð·Ð´ÐµÑÑŒ.",
    "Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¼Ð¾Ð·Ð³ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑƒÑÑ‚Ð°Ð» Ð¸ Ð½Ðµ Ð²Ñ‹Ð´Ð°Ñ‘Ñ‚ Ð½Ð¸Ñ‡ÐµÐ³Ð¾. ÐÐµ Ð´Ð°Ð²Ð¸ Ð½Ð° ÑÐµÐ±Ñ. Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð²ÑÐ¿Ð»Ñ‹Ð²Ñ‘Ñ‚ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸, Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ.",
    "ÐŸÑƒÑÑ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð°ÑƒÐ·Ð°. Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð¸ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ Ñ…Ð¾Ñ‚ÑŒ ÐºÑ€Ð¾ÑˆÐµÑ‡Ð½Ñ‹Ð¹ ÑÐ²ÐµÑ‚Ð»Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚.",
]

JOY_RESPONSES = [
    "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð° ÑÑ‚Ð¾ Ð² ÐºÐ¾Ð¿Ð¸Ð»ÐºÑƒ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð².",
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð°. ÐŸÑƒÑÑ‚ÑŒ ÑÑ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ð¹ Ð¾Ð¿Ð¾Ñ€Ð¾Ð¹ Ð½Ð° Ñ‚Ð²Ð¾Ð¹ Ð´ÐµÐ½ÑŒ.",
    "ÐžÑÑ‚Ð°Ð²Ð¸Ð»Ð° ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð·Ð´ÐµÑÑŒ â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½ Ð½Ðµ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»ÑÑ Ð² ÑÑƒÐµÑ‚Ðµ.",
    "Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»Ð° Ðº Ñ‚Ð²Ð¾Ð¸Ð¼ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑÐ¼. Ðš Ð½Ð¸Ð¼ Ð²ÑÐµÐ³Ð´Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ.",
    "Ð¡Ð»Ð¾Ð¶Ð¸Ð»Ð° ÑÑ‚Ð¾ Ð² Ñ‚Ð²Ð¾Ð¹ Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð·Ð°Ð¿Ð°Ñ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ñ… Ð²Ð¾ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹.",
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð°. ÐšÐ¾Ð³Ð´Ð°-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ñ‚Ñ‹ Ð¿ÐµÑ€ÐµÑ‡Ð¸Ñ‚Ð°ÐµÑˆÑŒ Ð¸ ÑƒÐ»Ñ‹Ð±Ð½Ñ‘ÑˆÑŒÑÑ ÑÑ‚Ð¾Ð¼Ñƒ Ð´Ð½ÑŽ.",
    "Ð‘ÐµÑ€ÐµÐ¶Ð½Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð°. Ð¢Ñ‹ Ð¿Ñ€Ð°Ð²Ð´Ð° ÑƒÐ¼ÐµÐµÑˆÑŒ Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ.",
    "Ð’Ð¾Ñ‚ ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ ÑƒÐ¶Ðµ Ð² Ñ‚Ð²Ð¾Ñ‘Ð¼ Ð´Ð½ÐµÐ²Ð½Ð¸ÐºÐµ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹.",
    "Ð¡Ð¿Ñ€ÑÑ‚Ð°Ð»Ð° ÑÑ‚Ñƒ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð·Ð´ÐµÑÑŒ, ÐºÐ°Ðº Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ ÑÐ¾ÐºÑ€Ð¾Ð²Ð¸Ñ‰Ð½Ñ‹Ð¹ Ñ‚Ð°Ð¹Ð½Ð¸Ðº.",
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð°. ÐŸÑƒÑÑ‚ÑŒ Ð¾Ð½ Ñ‚Ð¸Ñ…Ð¾ Ð³Ñ€ÐµÐµÑ‚ Ñ‚ÐµÐ±Ñ Ð¸Ð·Ð½ÑƒÑ‚Ñ€Ð¸.",
    "Ð£Ð»Ð¾Ð¶Ð¸Ð»Ð° ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¼Ð¸ Ð²Ð¾ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸ÑÐ¼Ð¸.",
    "Ð­Ñ‚Ð¾Ñ‚ ÐºÑƒÑÐ¾Ñ‡ÐµÐº Ð´Ð½Ñ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð½Ðµ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐµÑ‚ÑÑ, Ñ ÐµÐ³Ð¾ Ð·Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ð»Ð°.",
    "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð°, ÐºÐ°Ðº Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ð¿Ð¾Ð¼ÐµÑ‚ÐºÑƒ: Â«Ð·Ð´ÐµÑÑŒ Ð±Ñ‹Ð»Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾Â».",
    "Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»Ð° Ð² Ñ‚Ð²Ð¾ÑŽ Ð»Ð¸Ñ‡Ð½ÑƒÑŽ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ ÑƒÑŽÑ‚Ð½Ñ‹Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð².",
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð°. Ð­Ñ‚Ð¾ ÐµÑ‰Ñ‘ Ð¾Ð´Ð¸Ð½ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚ Ð² Ð¿Ð¾Ð»ÑŒÐ·Ñƒ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°ÐµÑˆÑŒ Ð´Ð½Ð¸ Ð·Ñ€Ñ.",
    "Ð¡Ð´ÐµÐ»Ð°Ð»Ð° Ð¿Ð¾Ð¼ÐµÑ‚ÐºÑƒ: Ð² ÑÑ‚Ð¾Ð¼ Ð´Ð½Ðµ Ñ‚Ð¾Ð¶Ðµ ÐµÑÑ‚ÑŒ Ð¼ÐµÑÑ‚Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ¿Ð»Ð°.",
    "Ð­Ñ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¶Ð¸Ð²Ñ‘Ñ‚ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð³Ð¾Ð»Ð¾Ð²Ðµ, Ð½Ð¾ Ð¸ Ð² Ñ‚Ð²Ð¾Ñ‘Ð¼ Ð´Ð½ÐµÐ²Ð½Ð¸ÐºÐµ.",
    "ÐŸÐ¾Ð»Ð¾Ð¶Ð¸Ð»Ð° ÑÑ‚Ñƒ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð² Ñ‚Ð²Ð¾Ð¹ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ Â«Ð°Ð»ÑŒÐ±Ð¾Ð¼ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾Â».",
    "Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð°, ÐºÐ°Ðº Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ: Ð´Ð°Ð¶Ðµ Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… Ð´Ð½ÑÑ… ÐµÑÑ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¶Ð¸Ð²Ð¾Ðµ Ð¸ Ñ‚Ñ‘Ð¿Ð»Ð¾Ðµ.",
    "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð°. ÐšÐ¾Ð³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ñ‚ÑÐ¶ÐµÐ»Ð¾, Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð¿ÐµÑ€ÐµÑ‚ÑŒÑÑ Ð¸ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ñ‚Ð¾Ð¶Ðµ.",
]

SAD_RITUAL_DAYS = 3
SAD_RITUAL_THRESHOLD = 3

THEME_KEYWORDS: Dict[str, List[str]] = {
    "ÐµÐ´Ð°": [
        "ÐºÐ¾Ñ„Ðµ", "Ñ‡Ð°Ð¹", "ÐºÐ°ÐºÐ°Ð¾", "Ð¿ÐµÑ‡ÐµÐ½ÑŒ", "Ð¿ÐµÑ‡ÐµÐ½ÑŒÐµ", "Ð¿Ð¸Ñ†Ñ†Ð°", "Ñ‚Ð¾Ñ€Ñ‚", "Ñ‚Ð¾Ñ€Ñ‚Ð¸Ðº",
        "Ð´ÐµÑÐµÑ€Ñ‚", "ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´", "ÐºÐ¾Ð½Ñ„ÐµÑ‚", "ÐºÐ¾Ð½Ñ„ÐµÑ‚Ð°", "ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´ÐºÐ°", "Ð¾Ð±ÐµÐ´", "ÑƒÐ¶Ð¸Ð½",
        "Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº", "Ð¾Ð±ÐµÐ´Ð°Ð»Ð°", "Ð¾Ð±ÐµÐ´Ð°Ð»", "ÑƒÐ¶Ð¸Ð½Ð°Ð»Ð°", "ÑƒÐ¶Ð¸Ð½Ð°Ð»", "Ð·Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ°Ð»Ð°",
        "Ð·Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ°Ð»", "ÐºÐ°Ñ„Ðµ", "Ñ€ÐµÑÑ‚Ð¾Ñ€Ð°", "Ð±ÑƒÐ»Ð¾Ñ‡", "ÐºÑ€ÑƒÐ°ÑÑÐ°Ð½", "Ð²ÐºÑƒÑÐ½Ð¾", "Ñ„Ñ€ÑƒÐºÑ‚Ñ‹",
        "ÑÐ³Ð¾Ð´Ñ‹", "ÑÑƒÑˆÐ¸", "Ñ€Ð¾Ð»Ð»Ñ‹", "ÑÐ°Ð»Ð°Ñ‚", "ÐµÐ´Ð°", "Ð¿Ð¾ÐµÑÑ‚ÑŒ",
    ],
    "Ð»ÑŽÐ´Ð¸": [
        "Ð¿Ð¾Ð´Ñ€ÑƒÐ³Ð°", "Ð¿Ð¾Ð´Ñ€ÑƒÐ¶ÐºÐ°", "Ð¿Ð¾Ð´Ñ€ÑƒÐ³Ð¸", "Ð´Ñ€ÑƒÐ³", "Ð´Ñ€ÑƒÐ·ÑŒÑ", "ÐºÐ¾Ð»Ð»ÐµÐ³", "Ð¼Ð°Ð¼Ð°",
        "Ð¿Ð°Ð¿Ð°", "Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»", "ÑÐµÐ¼ÑŒÑ", "Ð±Ñ€Ð°Ñ‚", "ÑÐµÑÑ‚Ñ€Ð°", "Ð±Ð°Ð±ÑƒÑˆÐºÐ°", "Ð´ÐµÐ´ÑƒÑˆÐºÐ°",
        "Ð¿Ð°Ñ€ÐµÐ½ÑŒ", "Ð¼ÑƒÐ¶", "Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹", "Ð»ÑŽÐ±Ð¸Ð¼Ð°Ñ", "Ð²ÑÑ‚Ñ€ÐµÑ‚Ð¸Ð»", "Ð²ÑÑ‚Ñ€ÐµÑ‚Ð¸Ð»Ð°",
        "ÑÐ¾Ð·Ð²Ð¾Ð½", "Ð·Ð²Ð¾Ð½Ð¾Ðº", "Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ°", "Ñ‡Ð°Ñ‚", "ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ", "Ð²Ð¼ÐµÑÑ‚Ðµ", "Ð¾Ð±Ð½ÑÐ»",
        "Ð¾Ð±Ð½ÑÐ»Ð°", "Ð¾Ð±Ð½ÑÐ»Ð¸ÑÑŒ", "Ð¾Ð±ÑŠÑÑ‚Ð¸Ñ",
    ],
    "Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð°": [
        "Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ°", "Ð³ÑƒÐ»ÑÐ»Ð°", "Ð³ÑƒÐ»ÑÐ»", "Ð¿Ð°Ñ€Ðº", "Ð»ÐµÑ", "Ñ€ÐµÐºÐ°", "Ð¾Ð·ÐµÑ€Ð¾", "Ð¼Ð¾Ñ€Ðµ",
        "Ð²Ð¾Ð·Ð´ÑƒÑ…", "ÑÐ²ÐµÐ¶Ð¸Ð¹ Ð²Ð¾Ð·Ð´ÑƒÑ…", "ÑÐ¾Ð»Ð½Ñ†Ðµ", "ÑÐ¾Ð»Ð½ÐµÑ‡Ð½Ð¾", "Ñ‚Ñ‘Ð¿Ð»Ð°Ñ Ð¿Ð¾Ð³Ð¾Ð´Ð°",
        "Ñ‚ÐµÐ¿Ð»Ð°Ñ Ð¿Ð¾Ð³Ð¾Ð´Ð°", "ÑÐ½ÐµÐ³", "Ð´Ð¾Ð¶Ð´ÑŒ", "Ð»Ð¸ÑÑ‚", "Ð»Ð¸ÑÑ‚ÑŒÑ", "Ñ‚Ñ€Ð°Ð²Ð°", "Ñ†Ð²ÐµÑ‚Ñ‹",
        "Ñ†Ð²ÐµÑ‚Ð¾Ðº", "Ð½ÐµÐ±Ð¾", "Ñ€Ð°ÑÑÐ²ÐµÑ‚", "Ð·Ð°ÐºÐ°Ñ‚",
    ],
    "Ð¾Ñ‚Ð´Ñ‹Ñ…": [
        "Ð¾Ñ‚Ð´Ñ‹Ñ…", "Ð¾Ñ‚Ð´Ð¾Ñ…Ð½ÑƒÐ»Ð°", "Ð¾Ñ‚Ð´Ð¾Ñ…Ð½ÑƒÐ»", "Ð¿Ð¾Ð»ÐµÐ¶Ð°Ð»Ð°", "Ð¿Ð¾Ð»ÐµÐ¶Ð°Ð»", "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°Ð»Ð°",
        "Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´ÐµÐ»Ð°Ð»", "Ð²Ñ‹ÑÐ¿Ð°Ð»Ð°ÑÑŒ", "Ð²Ñ‹ÑÐ¿Ð°Ð»ÑÑ", "ÑÐ¾Ð½", "ÑÐ¿Ð°Ð»Ð°", "ÑÐ¿Ð°Ð»",
        "Ñ€ÐµÐ»Ð°ÐºÑ", "Ñ€Ð°ÑÑÐ»Ð°Ð±Ð¸Ð»Ð°ÑÑŒ", "Ñ€Ð°ÑÑÐ»Ð°Ð±Ð¸Ð»ÑÑ", "Ð²Ð°Ð½Ð½Ð°", "Ð¼Ð°ÑÐºÐ° Ð´Ð»Ñ Ð»Ð¸Ñ†Ð°",
        "ÑÐ¿Ð°", "Ñ‚Ð¸ÑˆÐ¸Ð½Ð°", "Ð¿Ð¾ÐºÐ¾Ð¹", "Ð¿Ð°ÑƒÐ·Ñƒ", "Ð¿ÐµÑ€ÐµÐ´Ñ‹ÑˆÐºÐ°",
    ],
    "ÑƒÑÐ¿ÐµÑ…Ð¸": [
        "ÑÐ´ÐµÐ»Ð°Ð»Ð°", "ÑÐ´ÐµÐ»Ð°Ð»", "ÑƒÑÐ¿ÐµÐ»Ð°", "ÑƒÑÐ¿ÐµÐ»", "Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð°", "Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»",
        "ÑÐ´Ð°Ð»Ð°", "ÑÐ´Ð°Ð»", "Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ", "ÑÐ¿Ñ€Ð°Ð²Ð¸Ð»Ð°ÑÑŒ", "ÑÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑÑ", "Ð´Ð¾Ð´ÐµÐ»Ð°Ð»Ð°",
        "Ð´Ð¾Ð´ÐµÐ»Ð°Ð»", "Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð»Ð°", "Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð»", "Ð¾Ñ‚Ñ‡Ð¸Ñ‚Ð°Ð»Ð°ÑÑŒ", "Ð¾Ñ‚Ñ‡Ð¸Ñ‚Ð°Ð»ÑÑ",
        "Ð¿Ð¾Ñ…Ð²Ð°Ð»Ð¸Ð»Ð¸", "Ð¿Ð¾Ñ…Ð²Ð°Ð»Ð°", "Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚", "Ð´Ð¾ÑÑ‚Ð¸Ð³Ð»Ð°", "Ð´Ð¾ÑÑ‚Ð¸Ð³", "Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ",
        "ÑˆÐ°Ð³ Ð²Ð¿ÐµÑ€Ñ‘Ð´", "ÑˆÐ°Ð³ Ð²Ð¿ÐµÑ€ÐµÐ´",
    ],
}

LAST_JOY_INDEX: dict[int, int] = {}

# --------------------------
# Telegram API
# --------------------------

def get_updates(offset: Optional[int] = None, timeout: int = POLL_TIMEOUT) -> List[dict]:
    params = {"timeout": timeout}
    if offset is not None:
        params["offset"] = offset
    try:
        resp = requests.get(f"{API_URL}/getUpdates", params=params, timeout=timeout + 5)
        data = resp.json()
        if not data.get("ok"):
            print("getUpdates error:", data)
            return []
        return data.get("result", [])
    except Exception as e:
        print("getUpdates exception:", e)
        return []


def send_message(chat_id: int, text: str):
    try:
        requests.post(
            f"{API_URL}/sendMessage",
            json={"chat_id": chat_id, "text": text},
            timeout=10,
        )
    except Exception as e:
        print("sendMessage error:", e)


# --------------------------
# DB
# --------------------------

def init_db():
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    # Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸
    cur.execute(
        """
        CREATE TABLE IF NOT EXISTS joys (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            chat_id INTEGER NOT NULL,
            text TEXT NOT NULL,
            created_at TEXT NOT NULL
        )
        """
    )
    # Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ðµ/Ð³Ñ€ÑƒÑÑ‚Ð½Ñ‹Ðµ/Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
    cur.execute(
        """
        CREATE TABLE IF NOT EXISTS sad_events (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            chat_id INTEGER NOT NULL,
            created_at TEXT NOT NULL
        )
        """
    )
    # ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð°
    cur.execute(
        """
        CREATE TABLE IF NOT EXISTS dialog_state (
            chat_id INTEGER PRIMARY KEY,
            state TEXT NOT NULL,
            meta TEXT,
            updated_at TEXT NOT NULL
        )
        """
    )
    # Ð¿Ð¸ÑÑŒÐ¼Ð° Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ
    cur.execute(
        """
        CREATE TABLE IF NOT EXISTS future_letters (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            chat_id INTEGER NOT NULL,
            text TEXT NOT NULL,
            send_at TEXT NOT NULL,
            created_at TEXT NOT NULL,
            sent INTEGER NOT NULL DEFAULT 0
        )
        """
    )
    conn.commit()
    conn.close()


def add_joy(chat_id: int, text: str):
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    created_at = datetime.now().isoformat(timespec="seconds")
    cur.execute(
        "INSERT INTO joys (chat_id, text, created_at) VALUES (?, ?, ?)",
        (chat_id, text, created_at),
    )
    conn.commit()
    conn.close()


def add_sad_event(chat_id: int):
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    created_at = datetime.now().isoformat(timespec="seconds")
    cur.execute(
        "INSERT INTO sad_events (chat_id, created_at) VALUES (?, ?)",
        (chat_id, created_at),
    )
    conn.commit()
    conn.close()


def get_sad_count_last_days(chat_id: int, days: int) -> int:
    today_local = datetime.now().date()
    start = today_local - timedelta(days=days - 1)
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        SELECT COUNT(*)
        FROM sad_events
        WHERE chat_id = ?
          AND substr(created_at,1,10) >= ?
        """,
        (chat_id, start.isoformat()),
    )
    count = cur.fetchone()[0]
    conn.close()
    return count


def get_joys_for_week(chat_id: int, week_start: date) -> List[Tuple[str, str]]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    start_str = week_start.isoformat()
    cur.execute(
        """
        SELECT created_at, text
        FROM joys
        WHERE chat_id = ?
          AND substr(created_at, 1, 10) >= ?
        ORDER BY created_at ASC
        """,
        (chat_id, start_str),
    )
    rows = cur.fetchall()
    conn.close()
    return rows


def get_joys_for_date(chat_id: int, date_obj: date) -> List[Tuple[str, str]]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    date_str = date_obj.isoformat()
    cur.execute(
        """
        SELECT created_at, text
        FROM joys
        WHERE chat_id = ?
          AND substr(created_at,1,10) = ?
        ORDER BY created_at ASC
        """,
        (chat_id, date_str),
    )
    rows = cur.fetchall()
    conn.close()
    return rows


def get_joys_between(chat_id: int, start_date: date, end_date: date) -> List[Tuple[str, str]]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    start_str = start_date.isoformat()
    end_str = end_date.isoformat()
    cur.execute(
        """
        SELECT created_at, text
        FROM joys
        WHERE chat_id = ?
          AND substr(created_at,1,10) >= ?
          AND substr(created_at,1,10) <= ?
        ORDER BY created_at ASC
        """,
        (chat_id, start_str, end_str),
    )
    rows = cur.fetchall()
    conn.close()
    return rows


def has_joy_for_date(chat_id: int, date_obj: date) -> bool:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    date_str = date_obj.isoformat()
    cur.execute(
        """
        SELECT COUNT(*)
        FROM joys
        WHERE chat_id = ?
          AND substr(created_at, 1, 10) = ?
        """,
        (chat_id, date_str),
    )
    count = cur.fetchone()[0]
    conn.close()
    return count > 0


def get_all_user_ids() -> List[int]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute("SELECT DISTINCT chat_id FROM joys")
    rows = cur.fetchall()
    conn.close()
    return [r[0] for r in rows]


def get_joy_count(chat_id: int) -> int:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        "SELECT COUNT(*) FROM joys WHERE chat_id = ?",
        (chat_id,),
    )
    count = cur.fetchone()[0]
    conn.close()
    return count


def get_distinct_joy_dates(chat_id: int) -> List[date]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        SELECT DISTINCT substr(created_at, 1, 10) as d
        FROM joys
        WHERE chat_id = ?
        ORDER BY d ASC
        """,
        (chat_id,),
    )
    rows = cur.fetchall()
    conn.close()
    dates = []
    for (d_str,) in rows:
        try:
            dates.append(date.fromisoformat(d_str))
        except Exception:
            pass
    return dates


def get_first_joy_date(chat_id: int) -> Optional[date]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        SELECT MIN(substr(created_at, 1, 10))
        FROM joys
        WHERE chat_id = ?
        """,
        (chat_id,),
    )
    row = cur.fetchone()
    conn.close()
    if row and row[0]:
        try:
            return date.fromisoformat(row[0])
        except Exception:
            return None
    return None


def get_joys_last_n_days(chat_id: int, days: int = 7) -> int:
    today_local = datetime.now().date()
    start = today_local - timedelta(days=days - 1)
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        SELECT COUNT(*)
        FROM joys
        WHERE chat_id = ?
          AND substr(created_at,1,10) >= ?
        """,
        (chat_id, start.isoformat()),
    )
    count = cur.fetchone()[0]
    conn.close()
    return count


def get_current_streak(chat_id: int) -> int:
    dates = get_distinct_joy_dates(chat_id)
    if not dates:
        return 0
    today_local = datetime.now().date()
    last_date = dates[-1]
    if last_date < today_local - timedelta(days=1):
        return 0
    streak = 1
    i = len(dates) - 1
    while i > 0:
        if (dates[i] - dates[i - 1]).days == 1:
            streak += 1
            i -= 1
        else:
            break
    return streak


# dialog_state helpers

def set_dialog_state(chat_id: int, state: str, meta: Optional[dict] = None):
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    now = datetime.now().isoformat(timespec="seconds")
    meta_json = json.dumps(meta) if meta is not None else None
    cur.execute(
        """
        INSERT INTO dialog_state (chat_id, state, meta, updated_at)
        VALUES (?, ?, ?, ?)
        ON CONFLICT(chat_id) DO UPDATE SET
            state = excluded.state,
            meta = excluded.meta,
            updated_at = excluded.updated_at
        """,
        (chat_id, state, meta_json, now),
    )
    conn.commit()
    conn.close()


def get_dialog_state(chat_id: int) -> Tuple[Optional[str], Optional[dict]]:
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        "SELECT state, meta FROM dialog_state WHERE chat_id = ?",
        (chat_id,),
    )
    row = cur.fetchone()
    conn.close()
    if not row:
        return None, None
    state, meta_json = row
    meta = None
    if meta_json:
        try:
            meta = json.loads(meta_json)
        except Exception:
            meta = None
    return state, meta


def clear_dialog_state(chat_id: int):
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute("DELETE FROM dialog_state WHERE chat_id = ?", (chat_id,))
    conn.commit()
    conn.close()


# future letters helpers

def add_future_letter(chat_id: int, text: str, days_ahead: int):
    now = datetime.now()
    send_at = now + timedelta(days=days_ahead)
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        INSERT INTO future_letters (chat_id, text, send_at, created_at, sent)
        VALUES (?, ?, ?, ?, 0)
        """,
        (
            chat_id,
            text,
            send_at.isoformat(timespec="seconds"),
            now.isoformat(timespec="seconds"),
        ),
    )
    conn.commit()
    conn.close()


def get_due_letters() -> List[Tuple[int, int, str, str, str]]:
    now_iso = datetime.now().isoformat(timespec="seconds")
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute(
        """
        SELECT id, chat_id, text, send_at, created_at
        FROM future_letters
        WHERE sent = 0
          AND send_at <= ?
        """,
        (now_iso,),
    )
    rows = cur.fetchall()
    conn.close()
    return rows


def mark_letter_sent(letter_id: int):
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute("UPDATE future_letters SET sent = 1 WHERE id = ?", (letter_id,))
    conn.commit()
    conn.close()


# --------------------------
# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚ÐµÐºÑÑ‚Ð°
# --------------------------

def clean_profanity(text: str) -> str:
    lower = text.lower()
    for bad in BAD_WORDS:
        if bad in lower:
            replacement = "*" * len(bad)
            res_chars = []
            i = 0
            while i < len(text):
                segment = text[i:i + len(bad)]
                if segment.lower() == bad:
                    res_chars.append(replacement)
                    i += len(bad)
                else:
                    res_chars.append(text[i])
                    i += 1
            text = "".join(res_chars)
            lower = text.lower()
    return text


def fix_spelling_with_languagetool(text: str) -> str:
    if not USE_LANGTOOL:
        return text
    try:
        resp = requests.post(
            LANGTOOL_URL,
            data={"text": text, "language": "ru"},
            timeout=10,
        )
        data = resp.json()
        matches = data.get("matches", [])
        if not matches:
            return text
        text_chars = list(text)
        for m in reversed(matches):
            repls = m.get("replacements")
            if not repls:
                continue
            best = repls[0].get("value")
            offset = m.get("offset", 0)
            length = m.get("length", 0)
            text_chars[offset: offset + length] = list(best)
        return "".join(text_chars)
    except Exception as e:
        print("LanguageTool error:", e)
        return text


def clean_text_pipeline(text: str) -> str:
    text = text.strip()
    if not text:
        return text
    text = clean_profanity(text)
    text = fix_spelling_with_languagetool(text)
    return text


def normalize_text_for_match(text: str) -> str:
    lower = text.lower().replace("Ñ‘", "Ðµ")
    normalized = re.sub(r"[^\w\s]+", " ", lower)
    normalized = " ".join(normalized.split())
    return normalized


# --------------------------
# Ð Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¹
# --------------------------

def is_severe_sad_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in SEVERE_SAD_PATTERNS)


def is_sad_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in SAD_PATTERNS)


def is_tired_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in TIRED_PATTERNS)


def is_anxiety_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in ANXIETY_PATTERNS)


def is_no_joy_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in NO_JOY_PATTERNS)


def is_cancel_message(text: str) -> bool:
    lower = normalize_text_for_match(text)
    return any(p in lower for p in CANCEL_PATTERNS)


def is_greeting_message(text: str) -> bool:
    """
    Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸ÐµÐ¼, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¾ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ
    Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ/ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¾Ð´Ð¸Ð½ Ð¸Ð· Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð² Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ.
    """
    lower = normalize_text_for_match(text)
    if len(lower) > 40:
        return False
    for p in GREETING_PATTERNS:
        if lower == p or lower.startswith(p) or f" {p} " in f" {lower} ":
            return True
    return False


# --------------------------
# Ð¢ÐµÐ¼Ñ‹ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹ (Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ)
# --------------------------

def classify_joy_themes(text: str) -> List[str]:
    result = []
    norm = normalize_text_for_match(text)
    for theme, keywords in THEME_KEYWORDS.items():
        for kw in keywords:
            if kw in norm:
                result.append(theme)
                break
    return result


def summarize_themes(theme_counts: Dict[str, int]) -> Optional[str]:
    filtered = {k: v for k, v in theme_counts.items() if v > 0}
    if not filtered:
        return None
    sorted_themes = sorted(filtered.items(), key=lambda x: x[1], reverse=True)
    names = [t[0] for t in sorted_themes[:3]]

    if len(names) == 1:
        return f"Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾ Ñ‚ÐµÐ±Ñ Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»Ð° {names[0]}."
    elif len(names) == 2:
        return f"Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾ Ñ‚ÐµÐ±Ñ Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»Ð¸ {names[0]} Ð¸ {names[1]}."
    else:
        return f"Ñ‡Ð°Ñ‰Ðµ Ð²ÑÐµÐ³Ð¾ Ñ‚ÐµÐ±Ñ Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»Ð¸ {names[0]}, {names[1]} Ð¸ {names[2]}."


# --------------------------
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
# --------------------------

def add_emoji_prefix(text: str) -> str:
    return f"{random.choice(CALM_EMOJIS)} {text}"


def get_sad_response() -> str:
    return add_emoji_prefix(random.choice(SAD_RESPONSES))


def get_tired_response() -> str:
    return add_emoji_prefix(random.choice(TIRED_RESPONSES))


def get_anxiety_response() -> str:
    return add_emoji_prefix(random.choice(ANXIETY_RESPONSES))


def get_greeting_response() -> str:
    return add_emoji_prefix(random.choice(GREETING_RESPONSES))


def get_no_joy_response() -> str:
    return add_emoji_prefix(random.choice(NO_JOY_RESPONSES))


def get_joy_response(chat_id: int) -> str:
    if not JOY_RESPONSES:
        return add_emoji_prefix("Ð—Ð°Ð¿Ð¸ÑÐ°Ð»Ð° ÑÑ‚Ð¾ ÐºÐ°Ðº Ñ‚Ð²Ð¾ÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ.")
    last_idx = LAST_JOY_INDEX.get(chat_id)
    idx = random.randrange(len(JOY_RESPONSES))
    if last_idx is not None and len(JOY_RESPONSES) > 1:
        for _ in range(3):
            if idx != last_idx:
                break
            idx = random.randrange(len(JOY_RESPONSES))
    LAST_JOY_INDEX[chat_id] = idx
    return add_emoji_prefix(JOY_RESPONSES[idx])


# --------------------------
# ÐÑ‡Ð¸Ð²ÐºÐ¸
# --------------------------

def check_and_send_achievements(chat_id: int):
    total = get_joy_count(chat_id)
    streak = get_current_streak(chat_id)

    messages = []

    if total == 1:
        options = [
            "Ð¢Ñ‹ ÑÐ´ÐµÐ»Ð°Ð»Ð° Ð¿ÐµÑ€Ð²Ñ‹Ð¹ ÑˆÐ°Ð³ â€” Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð»Ð° ÑÐ²Ð¾ÑŽ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ. Ð­Ñ‚Ð¾ ÑƒÐ¶Ðµ Ð·Ð°Ð±Ð¾Ñ‚Ð° Ð¾ ÑÐµÐ±Ðµ.",
            "ÐŸÐµÑ€Ð²Ð°Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½Ð°. Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐµ, Ñ‚Ð¸Ñ…Ð¾Ðµ Ð½Ð°Ñ‡Ð°Ð»Ð¾.",
            "ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ ÐµÑÑ‚ÑŒ. Ð”Ð°Ð»ÑŒÑˆÐµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð²Ð¸Ð³Ð°Ñ‚ÑŒÑÑ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¼Ð¸ ÑˆÐ°Ð³Ð°Ð¼Ð¸.",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))
    elif total == 7:
        options = [
            "Ð£ Ñ‚ÐµÐ±Ñ ÑƒÐ¶Ðµ ÑÐ»Ð¾Ð¶Ð¸Ð»Ð°ÑÑŒ Ñ†ÐµÐ»Ð°Ñ Ð½ÐµÐ´ÐµÐ»Ñ Ñ Ð¾Ñ‚Ð¼ÐµÑ‡ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑÐ¼Ð¸. ÐšÑ€Ð°ÑÐ¸Ð²Ð°Ñ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ°.",
            "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ñ‚Ñ‹ ÑƒÐ¶Ðµ Ð¿Ñ€Ð¸Ð²Ñ‹ÐºÐ»Ð° Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸.",
            "Ð¢Ñ‹ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑˆÑŒÑÑ ÑÑŽÐ´Ð° Ð¸ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑˆÑŒ ÑÐ²ÐµÑ‚Ð»Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ â€” ÑÑ‚Ð¾ Ñ†ÐµÐ½Ð½Ð¾.",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))
    elif total == 30:
        options = [
            "Ð£ Ñ‚ÐµÐ±Ñ ÑƒÐ¶Ðµ Ð¼Ð½Ð¾Ð³Ð¾ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ÑÑ‚Ð½Ñ‹Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð². Ð­Ñ‚Ð¾ Ñ†ÐµÐ»Ð°Ñ Ð»Ð¸Ñ‡Ð½Ð°Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ.",
            "Ð¡Ð¾Ð±Ñ€Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð¼ÐµÑ‚Ð½Ð¾ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹ â€” Ð¾Ð½Ð¸ ÑƒÐ¶Ðµ Ð½Ðµ Ñ‚ÐµÑ€ÑÑŽÑ‚ÑÑ Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸.",
            "Ð¢Ñ‹ Ð¾ÑÑ‚Ð°Ð²Ð¸Ð»Ð° Ð´Ð¾Ð²Ð¾Ð»ÑŒÐ½Ð¾ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ´ Ð¸Ð· Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð·Ð° ÑÐ¾Ð±Ð¾Ð¹.",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))

    if streak == 3:
        options = [
            "ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ñ‚Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸ÑˆÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ. Ð­Ñ‚Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾ Ðº ÑÐµÐ±Ðµ.",
            "Ð¢Ñ‹ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑˆÑŒ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ â€” ÑÑ‚Ð¾ ÑƒÐ¶Ðµ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ.",
            "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ñƒ Ñ‚ÐµÐ±Ñ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ° Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ðµ Ð´Ð°Ð¶Ðµ Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… Ð´Ð½ÑÑ….",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))
    elif streak == 7:
        options = [
            "ÐÐ° Ð¿Ñ€Ð¾Ñ‚ÑÐ¶ÐµÐ½Ð¸Ð¸ Ð½ÐµÐ´ÐµÐ»Ð¸ Ñ‚Ñ‹ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð° Ð´Ð»Ñ ÑÐµÐ±Ñ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‰ÐµÐµ.",
            "Ð¢Ñ‹ Ð´ÐµÑ€Ð¶Ð¸ÑˆÑŒ Ñ€Ð¸Ñ‚Ð¼, Ð½Ð°Ñ…Ð¾Ð´Ñ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ â€” ÑÑ‚Ð¾ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÑÐµÑ‚.",
            "ÐÐµÐ´ÐµÐ»Ñ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑÐ¼Ð¸ â€” Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚.",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))
    elif streak == 30:
        options = [
            "Ð¢Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑˆÑŒ Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ Ð¸Ð·Ð¾ Ð´Ð½Ñ Ð² Ð´ÐµÐ½ÑŒ. Ð­Ñ‚Ð¾ ÑÐµÑ€ÑŒÑ‘Ð·Ð½Ð°Ñ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑÑ Ñ€Ð°Ð±Ð¾Ñ‚Ð°.",
            "ÐšÐ°Ð¶ÐµÑ‚ÑÑ, Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸ ÑÑ‚Ð°Ð»Ð¸ ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ñ‡Ð°ÑÑ‚ÑŒÑŽ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ð´Ð½Ñ.",
            "Ð¢Ð¾, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÑÑ‚Ð¾Ð»ÑŒÐºÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ðµ Ð±Ñ€Ð¾ÑÐ°ÐµÑˆÑŒ ÑÑ‚Ð¾Ñ‚ Ð´Ð½ÐµÐ²Ð½Ð¸Ðº, Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð·Ð°Ð±Ð¾Ñ‚Ðµ Ð¾ ÑÐµÐ±Ðµ.",
        ]
        messages.append(add_emoji_prefix(random.choice(options)))

    # Ð’ÐÐ–ÐÐž: Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ Ð¾Ð´Ð½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð·Ð° Ñ€Ð°Ð·, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ ÑÐ¿Ð°Ð¼Ð¸Ñ‚ÑŒ
    if messages:
        send_message(chat_id, messages[0])


# --------------------------
# ÐÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¸ Ð¼ÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¾Ð±Ð·Ð¾Ñ€Ñ‹
# --------------------------

def send_weekly_human_summary(chat_id: int):
    today_local = datetime.now().date()
    start = today_local - timedelta(days=6)
    joys = get_joys_between(chat_id, start, today_local)

    # Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐµÐ¼ "Ð¼ÑƒÑÐ¾Ñ€" Ð¸ Ð¼Ð°Ñ‚
    filtered = []
    for created_at, text in joys:
        norm = normalize_text_for_match(text)
        if is_no_joy_message(text):
            continue
        if any(p in norm for p in BAD_WORDS):
            continue
        filtered.append((created_at, text))

    if not filtered:
        send_message(
            chat_id,
            add_emoji_prefix(
                "ÐÐ° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ Ñƒ Ð¼ÐµÐ½Ñ Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð½ÐµÑ‚ Ñ‚Ð²Ð¾Ð¸Ñ… Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹.\n"
                "Ð•ÑÐ»Ð¸ Ð´Ð°ÑˆÑŒ ÑÐµÐ±Ðµ ÑˆÐ°Ð½Ñ, Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÑƒÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð½Ñƒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ð¾Ð¿Ð¾Ñ€Ñƒ Ð² Ð´ÐµÐ½ÑŒ."
            )
        )
        return

    theme_counts: Dict[str, int] = {k: 0 for k in THEME_KEYWORDS.keys()}
    for _, text in filtered:
        themes = classify_joy_themes(text)
        for t in themes:
            theme_counts[t] += 1

    themes_phrase = summarize_themes(theme_counts)

    lines = []
    for created_at, text in filtered:
        try:
            dt = datetime.fromisoformat(created_at)
            date_str = dt.strftime("%d.%m")
        except Exception:
            date_str = created_at[:10]
        emo = random.choice(JOY_EMOJIS)
        lines.append(f"{emo} {date_str} â€” {text}")

    header = "Ð¡Ð¾Ð±Ñ€Ð°Ð»Ð° Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¾Ð±Ð·Ð¾Ñ€ Ð½ÐµÐ´ÐµÐ»Ð¸ â€” Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ñ‹Ð»Ð¸ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹:"
    body = "\n".join(lines)

    if themes_phrase:
        extra = (
            f"\n\nÐ•ÑÐ»Ð¸ ÑÐ¾Ð²ÑÐµÐ¼ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð½Ð° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ {themes_phrase} "
            "Ð­Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ Ñ‚ÐµÐ±Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚."
        )
    else:
        extra = ""

    send_message(chat_id, f"{header}\n\n{body}{extra}")


def send_monthly_human_summary(chat_id: int):
    today_local = datetime.now().date()
    first_this_month = today_local.replace(day=1)
    end_prev = first_this_month - timedelta(days=1)
    start_prev = end_prev.replace(day=1)

    joys = get_joys_between(chat_id, start_prev, end_prev)

    filtered = []
    for created_at, text in joys:
        norm = normalize_text_for_match(text)
        if is_no_joy_message(text):
            continue
        if any(p in norm for p in BAD_WORDS):
            continue
        filtered.append((created_at, text))

    if not filtered:
        send_message(
            chat_id,
            add_emoji_prefix(
                "Ð—Ð° Ð¿Ñ€Ð¾ÑˆÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ† Ñƒ Ð¼ÐµÐ½Ñ Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð½ÐµÑ‚ Ñ‚Ð²Ð¾Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹.\n"
                "Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, ÑÑ‚Ð¾Ñ‚ Ð¼ÐµÑÑÑ† Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑŒ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼ Ð±Ð¾Ð»ÐµÐµ Ñ‚Ñ‘Ð¿Ð»Ð¾Ð¹ Ð¸ Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ñ ÑÐ¾Ð±Ð¾Ð¹."
            )
        )
        return

    theme_counts: Dict[str, int] = {k: 0 for k in THEME_KEYWORDS.keys()}
    for _, text in filtered:
        themes = classify_joy_themes(text)
        for t in themes:
            theme_counts[t] += 1

    themes_phrase = summarize_themes(theme_counts)

    month_name = start_prev.strftime("%B")
    month_name_ru = {
        "January": "ÑÐ½Ð²Ð°Ñ€ÑŒ", "February": "Ñ„ÐµÐ²Ñ€Ð°Ð»ÑŒ", "March": "Ð¼Ð°Ñ€Ñ‚",
        "April": "Ð°Ð¿Ñ€ÐµÐ»ÑŒ", "May": "Ð¼Ð°Ð¹", "June": "Ð¸ÑŽÐ½ÑŒ",
        "July": "Ð¸ÑŽÐ»ÑŒ", "August": "Ð°Ð²Ð³ÑƒÑÑ‚", "September": "ÑÐµÐ½Ñ‚ÑÐ±Ñ€ÑŒ",
        "October": "Ð¾ÐºÑ‚ÑÐ±Ñ€ÑŒ", "November": "Ð½Ð¾ÑÐ±Ñ€ÑŒ", "December": "Ð´ÐµÐºÐ°Ð±Ñ€ÑŒ",
    }.get(month_name, month_name)

    header = f"ÐÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð²Ð·Ð³Ð»ÑÐ´ Ð½Ð°Ð·Ð°Ð´: Ñ‚Ð²Ð¾Ð¹ {month_name_ru}."
    if themes_phrase:
        intro = (
            f"{header}\n\n"
            f"Ð—Ð° ÑÑ‚Ð¾Ñ‚ Ð¼ÐµÑÑÑ† Ñƒ Ñ‚ÐµÐ±Ñ Ð½Ð°ÐºÐ¾Ð¿Ð¸Ð»Ð¾ÑÑŒ Ð½ÐµÐ¼Ð°Ð»Ð¾ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð². "
            f"Ð•ÑÐ»Ð¸ ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð½Ð° Ð²ÑÑ‘ Ð²Ð¼ÐµÑÑ‚Ðµ, Ð²Ð¸Ð´Ð½Ð¾, Ñ‡Ñ‚Ð¾ {themes_phrase}"
        )
    else:
        intro = (
            f"{header}\n\n"
            "Ð’ ÑÑ‚Ð¾Ð¼ Ð¼ÐµÑÑÑ†Ðµ Ñƒ Ñ‚ÐµÐ±Ñ Ð±Ñ‹Ð»Ð¾ Ð¼Ð½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð´Ð½ÐµÐ¹, Ð½Ð¾ Ñ‚Ñ‹ Ð²ÑÑ‘ Ñ€Ð°Ð²Ð½Ð¾ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð° Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾ Ð´Ð»Ñ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ñ… Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹. "
            "Ð­Ñ‚Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾ Ð¿Ð¾ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸ÑŽ Ðº ÑÐµÐ±Ðµ."
        )

    send_message(chat_id, add_emoji_prefix(intro))


# --------------------------
# Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°
# --------------------------

def send_stats(chat_id: int):
    total = get_joy_count(chat_id)
    last7 = get_joys_last_n_days(chat_id, 7)
    streak = get_current_streak(chat_id)
    first_date = get_first_joy_date(chat_id)

    em = random.choice(STATS_EMOJIS)

    if total == 0:
        send_message(
            chat_id,
            f"{em} ÐŸÐ¾ÐºÐ° Ñƒ Ñ‚ÐµÐ±Ñ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ñ… Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹.\n"
            "ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ Ð¾Ð´Ð½Ð¾Ð¹ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ Ñ€ÐµÑÑƒÑ€Ñ.\n\n"
            "Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ñ‚Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑˆÑŒ ÐµÑ‰Ñ‘ Ð¸ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐµÐ±Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ â€” Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /letter.\n"
            "Ð•ÑÐ»Ð¸ Ð¿Ð¾ Ñ…Ð¾Ð´Ñƒ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel."
        )
        return

    first_str = first_date.strftime("%d.%m.%Y") if first_date else "â€”"

    msg = (
        f"{em} ÐÐµÐ±Ð¾Ð»ÑŒÑˆÐ°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:\n\n"
        f"â€¢ Ð¢Ñ‹ ÑƒÐ¶Ðµ ÑÐ¾Ð±Ñ€Ð°Ð»Ð° Ð·Ð°Ð¼ÐµÑ‚Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð².\n"
        f"â€¢ Ð—Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹ Ñ‚Ñ‹ Ð²ÑÑ‘ Ñ€Ð°Ð²Ð½Ð¾ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð° Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ, Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð´Ð½Ð¸ Ð±Ñ‹Ð»Ð¸ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸.\n"
        f"â€¢ Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ ÑÐµÑ€Ð¸Ñ Ð´Ð½ÐµÐ¹, Ð³Ð´Ðµ Ñ‚Ñ‹ Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð²Ð°ÐµÑˆÑŒ Ð¿Ñ€Ð¾ ÑÐµÐ±Ñ.\n"
        f"â€¢ ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¿Ð¾ÑÐ²Ð¸Ð»Ð°ÑÑŒ: {first_str}.\n\n"
        "ÐšÐ°Ð¶Ð´Ð°Ñ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ°Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ â€” ÑÑ‚Ð¾ ÑˆÐ°Ð³ Ð² ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñƒ Ð±Ð¾Ð»ÐµÐµ Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ Ðº ÑÐµÐ±Ðµ.\n\n"
        "Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐµÐ±Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ â€” Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /letter.\n"
        "Ð ÐµÑÐ»Ð¸ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ, Ð²ÑÐµÐ³Ð´Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ /cancel."
    )
    send_message(chat_id, msg)


# --------------------------
# ÐŸÐ¸ÑÑŒÐ¼Ð¾ ÑÐµÐ±Ðµ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ
# --------------------------

def handle_letter_command(chat_id: int):
    clear_dialog_state(chat_id)
    send_message(
        chat_id,
        add_emoji_prefix(
            "Ð”Ð°Ð²Ð°Ð¹ ÑƒÑÑ‚Ñ€Ð¾Ð¸Ð¼ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ.\n\n"
            "Ð’Ñ‹Ð±ÐµÑ€Ð¸, ÐºÐ¾Ð³Ð´Ð° Ñ…Ð¾Ñ‡ÐµÑˆÑŒ ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ:\n"
            "â€¢ 7 â€” Ñ‡ÐµÑ€ÐµÐ· Ð½ÐµÐ´ÐµÐ»ÑŽ\n"
            "â€¢ 14 â€” Ñ‡ÐµÑ€ÐµÐ· Ð´Ð²Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸\n"
            "â€¢ 30 â€” Ñ‡ÐµÑ€ÐµÐ· Ð¼ÐµÑÑÑ†\n\n"
            "ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ñ†Ð¸Ñ„Ñ€Ñƒ: 7, 14 Ð¸Ð»Ð¸ 30.\n"
            "Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel Ð¸Ð»Ð¸ Â«Ð¾Ñ‚Ð¼ÐµÐ½Ð°Â»."
        )
    )
    set_dialog_state(chat_id, "await_letter_period", None)


def handle_letter_period(chat_id: int, text: str):
    if is_cancel_message(text):
        clear_dialog_state(chat_id)
        send_message(
            chat_id,
            add_emoji_prefix(
                "Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾, Ð¾Ñ‚Ð»Ð¾Ð¶Ð¸Ð¼ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ. Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº ÑÑ‚Ð¾Ð¹ Ð¸Ð´ÐµÐµ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /letter."
            )
        )
        return

    norm = normalize_text_for_match(text)
    if norm not in ["7", "14", "30"]:
        send_message(
            chat_id,
            add_emoji_prefix(
                "ÐÐµ ÑÐ¾Ð²ÑÐµÐ¼ Ð¿Ð¾Ð½ÑÐ»Ð° ÑÑ€Ð¾Ðº.\n"
                "ÐÐ°Ð¿Ð¸ÑˆÐ¸, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ†Ð¸Ñ„Ñ€Ñƒ: 7, 14 Ð¸Ð»Ð¸ 30.\n"
                "Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ â€” Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ /cancel."
            )
        )
        return
    days = int(norm)
    set_dialog_state(chat_id, "await_letter_text", {"days": days})
    send_message(
        chat_id,
        add_emoji_prefix(
            "Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾. ÐÐ°Ð¿Ð¸ÑˆÐ¸ ÑÐµÐ¹Ñ‡Ð°Ñ Ð¿Ð¸ÑÑŒÐ¼Ð¾ ÑÐµÐ±Ðµ â€” Ñ‚Ð¾Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð±ÑƒÐ´ÐµÑ‚ Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÐµÐ³Ð¾ Ñ‡ÐµÑ€ÐµÐ· ÑÑ‚Ð¾Ñ‚ ÑÑ€Ð¾Ðº.\n\n"
            "ÐœÐ¾Ð¶Ð½Ð¾ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ, ÐºÐ°Ðº Ñ‚Ñ‹ ÑÐµÐ±Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ ÑÐµÐ¹Ñ‡Ð°Ñ, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ðµ Ð²Ð°Ð¶Ð½Ð¾, Ð¾ Ñ‡Ñ‘Ð¼ Ð¼ÐµÑ‡Ñ‚Ð°ÐµÑˆÑŒ Ð¸Ð»Ð¸ Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ ÑÐµÐ±Ðµ Ð½Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ.\n"
            "Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel Ð¸Ð»Ð¸ Â«Ð¾Ñ‚Ð¼ÐµÐ½Ð°Â»."
        )
    )


def handle_letter_text(chat_id: int, text: str, meta: dict):
    if is_cancel_message(text):
        clear_dialog_state(chat_id)
        send_message(
            chat_id,
            add_emoji_prefix(
                "ÐžÐºÐµÐ¹, Ð±ÐµÐ· Ð¿Ð¸ÑÑŒÐ¼Ð°. Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº ÑÑ‚Ð¾Ð¹ Ð¸Ð´ÐµÐµ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ñ‹Ð·Ð¾Ð²Ð¸ /letter ÐµÑ‰Ñ‘ Ñ€Ð°Ð·."
            )
        )
        return

    days = meta.get("days", 7)
    cleaned = text.strip()
    if not cleaned:
        send_message(
            chat_id,
            add_emoji_prefix(
                "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼.\n"
                "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¿Ð°Ñ€Ñƒ ÑÑ‚Ñ€Ð¾Ðº Ð´Ð»Ñ ÑÐµÐ±Ñ Ð¸Ð· Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ³Ð¾. Ð˜Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel, ÐµÑÐ»Ð¸ Ð¿Ð¾ÐºÐ° Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ."
            )
        )
        return

    add_future_letter(chat_id, cleaned, days)
    clear_dialog_state(chat_id)

    target_date = (datetime.now() + timedelta(days=days)).strftime("%d.%m.%Y")
    send_message(
        chat_id,
        add_emoji_prefix(
            f"Ð¯ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑŽ ÑÑ‚Ð¾ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð¸ Ð¿Ñ€Ð¸ÑˆÐ»ÑŽ ÐµÐ³Ð¾ Ñ‚ÐµÐ±Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ {target_date}.\n"
            "ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð¸ÑˆÑŒ ÐµÐ³Ð¾, ÑÑ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ°Ñ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ ÑÐ¾Ð±Ð¾Ð¹ Ð¸Ð· Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾."
        )
    )


# --------------------------
# ÐÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹/Ð¼ÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ñ€Ð°Ð½Ð½ÐµÑ€Ñ‹
# --------------------------

def weekly_summary_runner():
    print("Weekly summary runner started.")
    sent_weeks = set()
    while True:
        now = datetime.now()
        today = now.date()
        year, week_num, _ = today.isocalendar()
        key = (year, week_num)
        for k in list(sent_weeks):
            if k[0] != year or k[1] != week_num:
                sent_weeks.remove(k)
        if now.isoweekday() == 7 and now.hour == 22 and now.minute == 15:
            if key not in sent_weeks:
                print("Sending weekly human summaries...")
                for user_id in get_all_user_ids():
                    try:
                        send_weekly_human_summary(user_id)
                    except Exception as e:
                        print(f"Error sending weekly summary to {user_id}:", e)
                sent_weeks.add(key)
        time.sleep(60)


def monthly_summary_runner():
    print("Monthly summary runner started.")
    sent_months = set()
    while True:
        now = datetime.now()
        today = now.date()
        ym = (today.year, today.month)
        for k in list(sent_months):
            if k != ym:
                sent_months.remove(k)
        if today.day == 1 and now.hour == 20 and now.minute == 0:
            if ym not in sent_months:
                print("Sending monthly human summaries...")
                for user_id in get_all_user_ids():
                    try:
                        send_monthly_human_summary(user_id)
                    except Exception as e:
                        print(f"Error sending monthly summary to {user_id}:", e)
                sent_months.add(ym)
        time.sleep(60)


# --------------------------
# Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ðµ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ (18:00)
# --------------------------

def daily_reminder_runner():
    print("Daily reminder runner started.")
    reminded_dates = set()
    while True:
        now = datetime.now()
        today = now.date()
        for d in list(reminded_dates):
            if d != today:
                reminded_dates.remove(d)
        if now.hour == 18 and now.minute == 0:
            if today not in reminded_dates:
                print("Sending daily reminders...")
                for user_id in get_all_user_ids():
                    try:
                        if not has_joy_for_date(user_id, today):
                            emo = random.choice(REMINDER_EMOJIS)
                            send_message(
                                user_id,
                                f"{emo} Ð£Ð¶Ðµ 18:00.\n"
                                "ÐžÑ‡ÐµÐ½ÑŒ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾, Ñ‡Ñ‚Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð±Ñ‹Ð» Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚. "
                                "Ð”Ð°Ð²Ð°Ð¹ Ð½Ðµ Ð´Ð°Ð´Ð¸Ð¼ ÐµÐ¼Ñƒ Ð¿Ð¾Ñ‚ÐµÑ€ÑÑ‚ÑŒÑÑ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¼Ð½Ðµ Ð¾ Ð½Ñ‘Ð¼."
                            )
                    except Exception as e:
                        print(f"Error sending daily reminder to {user_id}:", e)
                reminded_dates.add(today)
        time.sleep(60)


# --------------------------
# Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ (21:00)
# --------------------------

def send_daily_report_for_user(chat_id: int):
    today_local = datetime.now().date()
    joys = get_joys_for_date(chat_id, today_local)

    filtered = []
    for created_at, text in joys:
        norm = normalize_text_for_match(text)
        if is_no_joy_message(text):
            continue
        if any(p in norm for p in BAD_WORDS):
            continue
        filtered.append((created_at, text))

    if not filtered:
        send_message(
            chat_id,
            add_emoji_prefix(
                "Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ñƒ Ð¼ÐµÐ½Ñ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ñ… Ñ€Ð°Ð´Ð¾ÑÑ‚ÐµÐ¹.\n"
                "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ð´ÐµÐ½ÑŒ Ð±Ñ‹Ð» Ð½ÐµÐ¿Ñ€Ð¾ÑÑ‚Ñ‹Ð¼. Ð”Ð°Ð²Ð°Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‚Ð¼ÐµÑ‚Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐµÐ³Ð¾ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð»Ð°. "
                "Ð Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°Ñ‚ÑŒ Ñ…Ð¾Ñ‚ÑŒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ ÑÐ²ÐµÑ‚Ð»Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚.\n\n"
                "Ð•ÑÐ»Ð¸ Ð¾Ð´Ð½Ð°Ð¶Ð´Ñ‹ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐµÐ±Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ â€” Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /letter.\n"
                "Ð•ÑÐ»Ð¸ Ð¿Ð¾ Ñ…Ð¾Ð´Ñƒ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel."
            )
        )
        return

    lines = []
    for created_at, text in filtered:
        try:
            dt = datetime.fromisoformat(created_at)
            time_str = dt.strftime("%H:%M")
        except Exception:
            time_str = created_at[11:16]
        emo = random.choice(JOY_EMOJIS)
        lines.append(f"{emo} {time_str} â€” {text}")

    header = "ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ñ‚Ñ‹ ÑƒÑÐ¿ÐµÐ»Ð° Ð·Ð°Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ Ð² ÑÑ‚Ð¾Ð¼ Ð´Ð½Ðµ:"
    body = "\n".join(lines)
    tail = (
        "\n\nÐ•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¾Ð´Ð½Ð°Ð¶Ð´Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÐµÐ±Ðµ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ â€” Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /letter.\n"
        "Ð•ÑÐ»Ð¸ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel."
    )
    send_message(chat_id, f"{header}\n\n{body}{tail}")


def daily_report_runner():
    print("Daily report runner started.")
    reported_dates = set()
    while True:
        now = datetime.now()
        today = now.date()
        for d in list(reported_dates):
            if d != today:
                reported_dates.remove(d)
        if now.hour == 21 and now.minute == 0:
            if today not in reported_dates:
                print("Sending daily reports...")
                for user_id in get_all_user_ids():
                    try:
                        send_daily_report_for_user(user_id)
                    except Exception as e:
                        print(f"Error sending daily report to {user_id}:", e)
                reported_dates.add(today)
        time.sleep(60)


# --------------------------
# Ð Ð°Ð½Ð½ÐµÑ€ Ð¿Ð¸ÑÐµÐ¼ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ
# --------------------------

def future_letters_runner():
    print("Future letters runner started.")
    while True:
        try:
            letters = get_due_letters()
            if letters:
                print(f"Sending {len(letters)} future letters...")
            for letter_id, chat_id, text, send_at, created_at in letters:
                try:
                    try:
                        dt_created = datetime.fromisoformat(created_at)
                        dt_send = datetime.fromisoformat(send_at)
                        days_diff = (dt_send.date() - dt_created.date()).days
                    except Exception:
                        days_diff = None

                    if days_diff and days_diff > 0:
                        intro = (
                            "Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ñƒ Ñ‚ÐµÐ±Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ°Ñ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ ÑÐ¾Ð±Ð¾Ð¹ Ð¸Ð· Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾.\n\n"
                            f"Ð­Ñ‚Ð¾ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ñ‚Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ð»Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ {days_diff} Ð´Ð½ÐµÐ¹ Ð½Ð°Ð·Ð°Ð´:"
                        )
                    else:
                        intro = (
                            "Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ñƒ Ñ‚ÐµÐ±Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ°Ñ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð° Ñ ÑÐ¾Ð±Ð¾Ð¹ Ð¸Ð· Ð¿Ñ€Ð¾ÑˆÐ»Ð¾Ð³Ð¾.\n\n"
                            "Ð’Ð¾Ñ‚ Ð¿Ð¸ÑÑŒÐ¼Ð¾, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ñ‚Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ð»Ð° Ñ€Ð°Ð½ÑŒÑˆÐµ:"
                        )

                    full = f"{add_emoji_prefix(intro)}\n\n{text}"
                    send_message(chat_id, full)
                    mark_letter_sent(letter_id)
                except Exception as e:
                    print(f"Error sending future letter {letter_id}:", e)
        except Exception as e:
            print("future_letters_runner error:", e)
        time.sleep(60)


# --------------------------
# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ…
# --------------------------

def process_incoming_message(update: dict):
    if "message" not in update:
        return
    msg = update["message"]
    chat = msg.get("chat") or {}
    chat_id = chat.get("id")
    if chat_id is None:
        return
    text = msg.get("text", "")
    if not text:
        return

    stripped = text.strip()

    # Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð°Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð°
    if stripped.startswith("/cancel"):
        state, _ = get_dialog_state(chat_id)
        clear_dialog_state(chat_id)
        if state in ("await_letter_period", "await_letter_text"):
            send_message(
                chat_id,
                add_emoji_prefix(
                    "ÐžÐºÐµÐ¹, Ð¿Ð¸ÑÑŒÐ¼Ð¾ ÑÐµÐ±Ðµ Ð¿Ð¾ÐºÐ° Ð¾Ñ‚Ð»Ð¾Ð¶Ð¸Ð¼. Ð•ÑÐ»Ð¸ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ â€” Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /letter."
                )
            )
        else:
            send_message(
                chat_id,
                add_emoji_prefix(
                    "ÐžÑ‚Ð¼ÐµÐ½Ð¸Ð»Ð° Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð´Ð¸Ð°Ð»Ð¾Ð³. ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸, ÐºÐ¾Ð³Ð´Ð° Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ."
                )
            )
        return

    # ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹
    if stripped.startswith("/start"):
        clear_dialog_state(chat_id)
        send_message(
            chat_id,
            "ÐŸÑ€Ð¸Ð²ÐµÑ‚. Ð¯ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ñ‚ÐµÐ±Ðµ Ð·Ð°Ð¼ÐµÑ‡Ð°Ñ‚ÑŒ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð¸.\n\n"
            "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÑŽÐ´Ð° Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ðµ Ð¸Ð· Ð´Ð½Ñ: Ð²ÑÑ‚Ñ€ÐµÑ‡Ñƒ, Ð²ÐºÑƒÑÐ½Ñ‹Ð¹ ÐºÐ¾Ñ„Ðµ, ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€.\n"
            "Ð’ 18:00 Ñ Ð½Ð°Ð¿Ð¾Ð¼Ð½ÑŽ, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¿Ð¸ÑÐ°Ð»Ð°, Ð° Ð² 21:00 Ð¿Ñ€Ð¸ÑˆÐ»ÑŽ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð´ÐµÐ½ÑŒ.\n\n"
            "Ð ÐµÑ‰Ñ‘ Ð·Ð´ÐµÑÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¿Ð¸ÑÑŒÐ¼Ð¾ ÑÐµÐ±Ðµ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ â€” Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /letter.\n"
            "Ð•ÑÐ»Ð¸ Ð²Ð´Ñ€ÑƒÐ³ Ð¿Ð¾ Ñ…Ð¾Ð´Ñƒ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð° Ð¸Ð»Ð¸ Ð¿Ð¸ÑÑŒÐ¼Ð° Ñ‚Ñ‹ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑˆÑŒ â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸ /cancel.\n\n"
            "ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑƒÐ¶Ðµ ÑÐµÐ¹Ñ‡Ð°Ñ: Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¾Ð´Ð½Ñƒ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÑƒÑŽ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð¸Ð»Ð¸ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð¸Ð· ÑÑ‚Ð¾Ð³Ð¾ Ð´Ð½Ñ."
        )
        return

    if stripped.startswith("/stats"):
        send_stats(chat_id)
        return

    if stripped.startswith("/letter"):
        handle_letter_command(chat_id)
        return

    # Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð°
    state, meta = get_dialog_state(chat_id)
    if state == "await_letter_period":
        handle_letter_period(chat_id, text)
        return
    if state == "await_letter_text":
        handle_letter_text(chat_id, text, meta or {})
        return

    cleaned = clean_text_pipeline(text)
    if not cleaned:
        send_message(
            chat_id,
            "ÐœÐ½Ðµ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ.\n"
            "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ‡ÑƒÑ‚ÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½ÐµÐµ, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ñ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¿Ð¾Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»Ð¾."
        )
        return

    # ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ â€” Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÐ¼, Ð½Ð¾ ÐÐ• Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ðº Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ
    if is_greeting_message(cleaned):
        send_message(chat_id, get_greeting_response())
        return

    # ÐžÑ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
    if is_severe_sad_message(cleaned):
        send_message(
            chat_id,
            add_emoji_prefix(
                "Ð¡Ð»Ñ‹ÑˆÑƒ, Ñ‡Ñ‚Ð¾ Ñ‚ÐµÐ±Ðµ ÑÐµÐ¹Ñ‡Ð°Ñ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚ÑÐ¶ÐµÐ»Ð¾.\n\n"
                "Ð¡ Ñ‚Ð°ÐºÐ¸Ð¼Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð°Ð¼Ð¸ Ð½Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð¾Ð´Ð½Ð¾Ð¹. "
                "ÐŸÐ¾ÑÑ‚Ð°Ñ€Ð°Ð¹ÑÑ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ñ Ñ‚ÐµÐ¼, ÐºÐ¾Ð¼Ñƒ Ð´Ð¾Ð²ÐµÑ€ÑÐµÑˆÑŒ: Ð±Ð»Ð¸Ð·ÐºÐ¸Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº, Ð´Ñ€ÑƒÐ³, ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚.\n"
                "Ð¢Ñ‹ Ð²Ð°Ð¶Ð½Ð° Ð¸ Ð¸Ð¼ÐµÐµÑˆÑŒ Ð¿Ñ€Ð°Ð²Ð¾ Ð½Ð° Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ."
            )
        )
        add_sad_event(chat_id)
        return

    # Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°
    if is_anxiety_message(cleaned):
        send_message(chat_id, get_anxiety_response())
        add_sad_event(chat_id)
        return

    # Ð£ÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ
    if is_tired_message(cleaned):
        send_message(chat_id, get_tired_response())
        add_sad_event(chat_id)
        return

    # Ð“Ñ€ÑƒÑÑ‚ÑŒ
    if is_sad_message(cleaned):
        send_message(chat_id, get_sad_response())
        add_sad_event(chat_id)
        return

    # ÐÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ðµ "Ð½Ðµ Ð·Ð½Ð°ÑŽ, Ñ‡Ñ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ" â€” Ð½Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÐ¼
    if is_no_joy_message(cleaned):
        send_message(chat_id, get_no_joy_response())
        return

    # ÐžÐ±Ñ‹Ñ‡Ð½Ð°Ñ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ
    add_joy(chat_id, cleaned)
    send_message(chat_id, get_joy_response(chat_id))
    check_and_send_achievements(chat_id)


# --------------------------
# main
# --------------------------

def main():
    init_db()

    t_daily_reminder = threading.Thread(target=daily_reminder_runner, daemon=True)
    t_daily_reminder.start()

    t_daily_report = threading.Thread(target=daily_report_runner, daemon=True)
    t_daily_report.start()

    t_weekly = threading.Thread(target=weekly_summary_runner, daemon=True)
    t_weekly.start()

    t_monthly = threading.Thread(target=monthly_summary_runner, daemon=True)
    t_monthly.start()

    t_letters = threading.Thread(target=future_letters_runner, daemon=True)
    t_letters.start()

    offset = None
    print("ChudoMoodo bot polling started...")
    while True:
        updates = get_updates(offset=offset, timeout=POLL_TIMEOUT)
        for upd in updates:
            try:
                offset = max(offset or 0, upd["update_id"] + 1)
                process_incoming_message(upd)
            except Exception as e:
                print("process error:", e)
        time.sleep(POLL_SLEEP)


if __name__ == "__main__":
    main()


