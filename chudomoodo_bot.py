"""
chudomoodo_bot.py

Telegram-бот "Дневник маленьких радостей".

Функционал:
- принимает от пользователя короткие тексты-радости;
- очищает мат и нецензурную лексику (расширенный словарь корней);
- (опционально) исправляет орфографию и пунктуацию через LanguageTool;
- сохраняет радости в SQLite;
- ЕЖЕДНЕВНЫЙ РЕЖИМ:
    - в 18:00 — напоминание, если за день не было ни одной радости;
    - в 21:00 — отчёт с радостями за текущий день;
- защита от тоски: отдельные реакции на грусть, усталость, тревогу, тяжёлые фразы;
- спокойные тексты-ответы с одним эмодзи в начале;
- ачивки за количество радостей и стрики по дням (без упора на цифры в формулировках);
- статистика по команде /stats;
- ритуал «3 маленькие радости» (можно развивать, сейчас логика мягкая);
- письмо себе в будущее по команде /letter с возможностью отмены /cancel;
- расширенные словари грусти, усталости, тревоги и «не знаю, что написать»;
- более широкое распознавание приветствий (разговорные формы, сленг);
- отчёт за день не включает мат, технические фразы и «не знаю, что написать»;
- на одну эмоцию — один ответ (без дублирующих сообщений).
"""

import os
import time
import sqlite3
import threading
import random
import re
import json
from datetime import datetime, timedelta, date
from typing import List, Tuple, Optional, Dict

import requests

# --------------------------
# CONFIG
# --------------------------

TOKEN = os.getenv("TELEGRAM_TOKEN")
if not TOKEN:
    raise RuntimeError("Не задан TELEGRAM_TOKEN в переменных окружения.")

API_URL = f"https://api.telegram.org/bot{TOKEN}"
DB_PATH = os.path.join(os.path.dirname(__file__), "joys.db")

POLL_TIMEOUT = 30
POLL_SLEEP = 1

USE_LANGTOOL = False
LANGTOOL_URL = "https://api.languagetool.org/v2/check"

# --------------------------
# СЛОВАРИ
# --------------------------
# Важно: ниже не «ровно 200/300 фраз», а расширенные списки + корни слов,
# чтобы покрыть гораздо больше вариантов в живой речи.

# Расширенный список матов и "жёсткой" лексики.
BAD_WORDS = [
    # базовые корни
    "хуй", "хуи", "хуе", "хуё", "хуя", "хуем", "хуйн", "хуит", "хуяр",
    "хер", "хрен", "хрена", "хренов", "хренот", "хренотень",
    "пизд", "пизда", "пиздец", "пезд", "пидор", "пидар", "педрила",
    "еба", "ебу", "ебё", "ебе", "ебан", "ёбн", "ебло", "ебальн", "выеб",
    "еблись", "ебуч", "ебанут", "доеб", "заеб", "заёб", "заипал", "заипали",
    "сука", "суки", "сучк", "сучар", "сучонок",
    "бляд", "бля", "блят", "бляха", "бляха-муха", "бляха муха",
    "мразь", "тварь", "тварн", "скотина", "ублюд", "уебк", "уёбк",
    "гандон", "презик", "конча", "конченный", "конченый",
    "хуйня", "хуёв", "хренот", "говно", "говн", "дерьм", "срака",
    "сука-блять", "сука блять",
    # оскорбительные
    "долбоеб", "долбоёб", "дебил", "идиот", "кретин", "мудак", "мудила",
    "чмо", "чмошн", "козлина", "урод", "уродин",
    "шлюх", "проститут", "шалав", "траха", "трахну",
    "срать", "срал", "насрать", "насрал",
    # более завуалированные, но в токсичном контексте
    "бесишь", "морда кирпичом", "иди в жопу", "пошел в жопу", "пошла в жопу",
]

# Грусть, тоска, пустота, одиночество
SAD_PATTERNS = [
    "ничего хорошего не было", "ничего хорошего сегодня не было",
    "ничего хорошего", "ничего не радует", "ничто не радует",
    "всё плохо", "все плохо", "все ужасно", "всё ужасно", "совсем плохо",
    "ужасный день", "отвратительный день", "день говно", "день отстой",
    "день был ужасный", "день не задался", "день коту под хвост",
    "всё бесит", "все бесит", "все раздражает", "всё раздражает",
    "плохо", "очень плохо", "крайне плохо",
    "тяжело", "очень тяжело", "душно внутри",
    "грустно", "очень грустно", "мне грустно", "мне очень грустно",
    "тоскливо", "мне тоскливо",
    "хреново", "фигово", "отстойно", "мерзко на душе",
    "депрессивно", "депрессия накрыла", "депрессняк", "душа ноет",
    "ничего не хочется", "не хочу ничего", "ничего не могу", "нет желания вообще",
    "нет настроения", "ужас", "разочарование", "сплошное разочарование",
    "одиночество", "чувствую себя одиноко", "мне одиноко",
    "я одна", "я один", "осталась одна", "остался один",
    "никому не нужна", " никому не нужен",
    "меня никто не понимает", "никто не понимает", "меня не слышат",
    "я реву", "я плачу", "хочу плакать", "плакать хочется", "рыдаю",
    "опять сорвалась в слезы", "опять плачу",
    "сердце болит", "на душе тяжело", "на душе пусто", "внутри пусто",
    "как будто пустота", "очень пусто внутри",
    "не вижу радости", "радости нет", "нет ничего хорошего",
    "не за что зацепиться", "не к чему прижаться внутри",
    "все серое", "сплошная серая масса",
    "ощущение безысходности", "безысходность",
    "чувствую себя разбитой", "чувствую себя разбитым",
    "разбитое состояние",
]

# Усталость, выгорание, «нет сил»
TIRED_PATTERNS = [
    "устала", "устал", "я так устала", "я так устал",
    "очень устала", "очен устал",
    "сильно устала", "сильно устал",
    "сегодня вообще без сил", "сегодня нет сил",
    "сил нет", "нет сил", "ни на что нет сил",
    "совсем нет сил", "ни капли сил",
    "я вымоталась", "я вымотался", "вымоталась", "вымотался",
    "выгорела", "выгорел", "я выгорела", "я выгорел",
    "эмоционально выгорела", "эмоционально выгорел",
    "морально устала", "морально устал",
    "я очень устала морально", "я очень устал морально",
    "обессилена", "обессилен", "обессиленный", "обессиленная",
    "мне тяжело", "очень тяжело", "невыносимо тяжело",
    "чувствую сильную усталость", "чувствую усталость",
    "никаких сил", "сил буквально ноль",
    "пустая как выжатый лимон", "как выжатый лимон",
    "просто нет энергии", "энергия на нуле",
    "истощена", "истощен", "очень истощена", "очень истощен",
    "не могу больше", "не могу тянуть", "не тяну",
    "не хочу ничего делать", "нет ресурса", "нет ресурса вообще",
    "надоело все тащить", "слишком много нагрузки",
]

# Тревога, страх, паника
ANXIETY_PATTERNS = [
    "боюсь", "очень боюсь", "безумно боюсь",
    "мне страшно", "страшно", "дико страшно",
    "переживаю", "очень переживаю", "сильно переживаю",
    "я переживаю", "я опять переживаю",
    "тревожно", "очень тревожно", "дико тревожно",
    "меня трясет", "меня трясёт",
    "паника", "паническую", "панически", "паническая атака",
    "паникую", "опять паникую",
    "вдруг не получится", "вдруг всё испорчу", "вдруг всё пойдет не так",
    "вдруг всё пойдёт не так",
    "я не уверена", "я не уверен", "я не уверена в себе", "я не уверен в себе",
    "я сомневаюсь", "сомневаюсь в себе",
    "волнуюсь", "я волнуюсь", "очень волнуюсь",
    "я все испортила", "я все испортил",
    "я всё испортила", "я всё испортил",
    "боюсь ошибиться", "боюсь сделать ошибку",
    "страх, что не справлюсь", "боюсь, что не справлюсь",
    "страх будущего", "страшно за будущее",
    "сердце колотится", "сердце стучит слишком сильно",
    "руки трясутся", "мне тяжело дышать от тревоги",
    "как будто всё валится", "ощущение, что всё рухнет",
    "мне не по себе", "очень не по себе",
]

# Очень тяжёлые фразы
SEVERE_SAD_PATTERNS = [
    "не хочу жить", "не хочу больше жить",
    "нет смысла жить", "не вижу смысла жить",
    "не вижу смысла", "нет смысла",
    "жизнь бессмысленна", "жизнь не имеет смысла",
    "ненавижу свою жизнь", "ненавижу жизнь",
    "хочу умереть", "хочу просто исчезнуть",
    "лучше бы меня не было", "лучше бы я не родилась",
    "лучше бы я не родился",
    "не хочу существовать", "не хочу ничего чувствовать",
    "я ничтожество", "я никчемная", "я никчемный",
    "я бесполезная", "я бесполезный",
    "ненавижу себя", "себя ненавижу",
    "ненавижу всё", "ненавижу всех",
    "никому не нужна", "никому не нужен",
    "никто меня не любит", "меня никто не любит",
    "никто меня не слышит вообще",
    "мне кажется, что всем без разницы", "всем плевать на меня",
    "не хочу просыпаться", "не хочу вставать по утрам",
    "больше не вижу выхода",
]

# Нейтральные/пустые фразы «не знаю, что написать» (НЕ должны попадать в радости)
NO_JOY_PATTERNS = [
    # Не знаю что написать
    "не знаю что написать", "не знаю, что написать",
    "не знаю что писать", "не знаю, что писать",
    "не знаю что еще написать", "не знаю, что ещё написать",
    "не знаю что еще писать", "не знаю, что ещё писать",
    "вообще не знаю что написать", "вообще не знаю, что написать",
    "вообще не знаю что писать", "вообще не знаю, что писать",
    "не знаю как писать", "не знаю о чем писать",

    # Нечего — пусто
    "нечего писать", "нечего сказать", "нечего добавлять",
    "совсем нечего писать", "вообще нечего писать",
    "нечего рассказать", "нечего вспомнить",

    # Ничего хорошего не могу вспомнить
    "ничего не могу вспомнить", "ничего не запомнилось",
    "ничего такого не вспомнила", "ничего такого не вспомнил",
    "ничего приятного не было", "ничего радостного не было",
    "ничего хорошего не было", "ничего светлого не было",

    # Ничего не приходит в голову
    "ничего не приходит в голову",
    "мысли вообще не идут",
    "мозг не соображает",
    "никаких идей",
    "пусто в голове",
    "голова пустая",

    # Нет сил думать / вспоминать
    "нет сил думать",
    "нет сил вспоминать",
    "не хочется думать",
    "не получается думать",

    # Не могу придумать
    "не могу ничего придумать",
    "не могу придумать",
    "трудно придумать",
    "сложно придумать",
    "не получается написать",
    "не получается ничего придумать",
    "не выходит придумать",
    "не выходит вспомнить",

    # Был плохой день — нечего отметить
    "день был обычный",
    "день был серый",
    "день как день",
    "ничего особенного не было",
    "кажется ничего не произошло",
    "не произошло ничего радостного",
    "не произошло ничего хорошего",
    "ничего интересного не было",
    "ничего такого не было",
    "обычный день без радостей",
    "пустой день",
    "серый день",

    # Безразличие
    "мне все равно",
    "не чувствую ничего",
    "никаких эмоций",
    "просто день и день",
    "ничего не чувствую",
    "эмоций нет",

    # Прокрастинация/откладывание
    "не сейчас",
    "позже напишу",
    "потом напишу",
    "может позже вспомню",
    "не готова писать",

    # Не знаю радость ли это
    "не знаю радость ли это",
    "не уверена что это радость",
    "сомневаюсь что это считается",
    "это вроде не радость",
    "не уверена стоит ли это писать",

    # Всё плохо, но без явной грусти (пересекается с SAD, но мягче)
    "ничего хорошего",
    "ничего не радует",
    "ничего хорошего сегодня не было",
    "явно нечему радоваться",
    "не за что зацепиться",

    # Не до этого / нет ресурса
    "нет настроения писать",
    "нет вдохновения",
    "пока не до радостей",
    "не время
